define("vlm-dcl",["exports","@decentraland/EnvironmentAPI","@decentraland/SignedFetch","@decentraland/Identity","@decentraland/ParcelIdentity","@decentraland/RestrictedActions","@decentraland/Players"],(function(e,t,n,i,s,o,r){"use strict";var a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},a(e,t)};function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var u=function(){return u=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},u.apply(this,arguments)};function d(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}function l(e,t,n,i){var s,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,n,r):s(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r}function h(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))}function f(e,t){var n,i,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(r=0)),r;)try{if(n=1,i&&(s=2&a[0]?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(s=r.trys,(s=s.length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){r.label=a[1];break}if(6===a[0]&&r.label<s[1]){r.label=s[1],s=a;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(a);break}s[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],i=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,s,o=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return r}function v(e,t,n){if(n||2===arguments.length)for(var i,s=0,o=t.length;s<o;s++)!i&&s in t||(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return e.concat(i||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var g=function(){function e(){}var n;return n=e,e.wssUrls={dev:"ws://localhost:3010",staging:"wss://staging-api.vlm.gg",prod:"wss://api.vlm.gg"},e.apiUrls={dev:"http://localhost:3010",staging:"https://staging-api.vlm.gg",prod:"https://api.vlm.gg"},e.apiUrl="https://api.vlm.gg",e.wssUrl="wss://api.vlm.gg",e.init=function(e){return h(void 0,void 0,void 0,(function(){var i;return f(n,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),i=this,[4,t.isPreviewMode()];case 1:return i.devMode=n.sent(),e&&("prod"===e||this.devMode)||(e="prod"),log("VLM: Initializing ".concat(e," environment")),this.apiUrl=this.apiUrls[e],log("VLM: HTTPS Server set to "+this.apiUrl),this.wssUrl=this.wssUrls[e],log("VLM: WebSocket Server set to "+this.wssUrl),[3,3];case 2:throw n.sent();case 3:return[2]}}))}))},e}(),m={exports:{}};!function(e,t){var n;n=function(e){ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function i(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))}function s(e,t){var n,i,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=2&o[0]?i.return:o[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,o[1])).done)return s;switch(i=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((s=(s=r.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],i=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(e,t){t.headers=e.headers||{},t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.response}function r(e,t,n){return new Promise((function(i,s){n=n||{};var r,a,c,u=new XMLHttpRequest,d=n.body,l=n.headers||{};for(r in n.timeout&&(u.timeout=n.timeout),u.ontimeout=u.onerror=function(e){e.timeout="timeout"==e.type,s(e)},u.open(e,t.href||t),u.onload=function(){for(c=u.getAllResponseHeaders().trim().split(/[\r\n]+/),o(u,u);a=c.shift();)a=a.split(": "),u.headers[a.shift().toLowerCase()]=a.join(": ");if((a=u.headers["content-type"])&&~a.indexOf("application/json"))try{u.data=JSON.parse(u.data,n.reviver)}catch(e){return o(u,e),s(e)}(u.status>=400?s:i)(u)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(l["content-type"]="application/json",d=JSON.stringify(d)),u.withCredentials=!!n.withCredentials,l)u.setRequestHeader(r,l[r]);u.send(d)}))}var a=r.bind(r,"GET"),c=r.bind(r,"POST"),u=r.bind(r,"PATCH"),d=r.bind(r,"DELETE"),l=a,h=u,f=c,p=r.bind(r,"PUT"),v=r,g={del:d,get:l,patch:h,post:f,put:p,send:v},m=Object.freeze(Object.assign(Object.create(null),g,{default:g,del:d,get:l,patch:h,post:f,put:p,send:v})),y=function(e){function t(t,n){var i=e.call(this,n)||this;return i.name="ServerError",i.code=t,i}return n(t,e),t}(Error);function I(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}function E(e,t,n){for(var i=0,s=0,o=n.length;s<o;s++)(i=n.charCodeAt(s))<128?e.setUint8(t++,i):i<2048?(e.setUint8(t++,192|i>>6),e.setUint8(t++,128|63&i)):i<55296||i>=57344?(e.setUint8(t++,224|i>>12),e.setUint8(t++,128|i>>6&63),e.setUint8(t++,128|63&i)):(s++,i=65536+((1023&i)<<10|1023&n.charCodeAt(s)),e.setUint8(t++,240|i>>18),e.setUint8(t++,128|i>>12&63),e.setUint8(t++,128|i>>6&63),e.setUint8(t++,128|63&i))}function w(e,t,n){var i=typeof n,s=0,o=0,r=0,a=0,c=0,u=0;if("string"===i){if(c=function(e){for(var t=0,n=0,i=0,s=e.length;i<s;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(n),c<32)e.push(160|c),u=1;else if(c<256)e.push(217,c),u=2;else if(c<65536)e.push(218,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("String too long");e.push(219,c>>24,c>>16,c>>8,c),u=5}return t.push({_str:n,_length:c,_offset:e.length}),u+c}if("number"===i)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(e.push(n),1):n<256?(e.push(204,n),2):n<65536?(e.push(205,n>>8,n),3):n<4294967296?(e.push(206,n>>24,n>>16,n>>8,n),5):(r=n/Math.pow(2,32)>>0,a=n>>>0,e.push(207,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),9):n>=-32?(e.push(n),1):n>=-128?(e.push(208,n),2):n>=-32768?(e.push(209,n>>8,n),3):n>=-2147483648?(e.push(210,n>>24,n>>16,n>>8,n),5):(r=Math.floor(n/Math.pow(2,32)),a=n>>>0,e.push(211,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),9):(e.push(203),t.push({_float:n,_length:8,_offset:e.length}),9);if("object"===i){if(null===n)return e.push(192),1;if(Array.isArray(n)){if((c=n.length)<16)e.push(144|c),u=1;else if(c<65536)e.push(220,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Array too large");e.push(221,c>>24,c>>16,c>>8,c),u=5}for(s=0;s<c;s++)u+=w(e,t,n[s]);return u}if(n instanceof Date){var d=n.getTime();return r=Math.floor(d/Math.pow(2,32)),a=d>>>0,e.push(215,0,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),10}if(n instanceof ArrayBuffer){if((c=n.byteLength)<256)e.push(196,c),u=2;else if(c<65536)e.push(197,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Buffer too large");e.push(198,c>>24,c>>16,c>>8,c),u=5}return t.push({_bin:n,_length:c,_offset:e.length}),u+c}if("function"==typeof n.toJSON)return w(e,t,n.toJSON());var l=[],h="",f=Object.keys(n);for(s=0,o=f.length;s<o;s++)"function"!=typeof n[h=f[s]]&&l.push(h);if((c=l.length)<16)e.push(128|c),u=1;else if(c<65536)e.push(222,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Object too large");e.push(223,c>>24,c>>16,c>>8,c),u=5}for(s=0;s<c;s++)u+=w(e,t,h=l[s]),u+=w(e,t,n[h]);return u}if("boolean"===i)return e.push(n?195:194),1;if("undefined"===i)return e.push(212,0,0),3;throw new Error("Could not encode")}function T(e){var t=[],n=[],i=w(t,n,e),s=new ArrayBuffer(i),o=new DataView(s),r=0,a=0,c=-1;n.length>0&&(c=n[0]._offset);for(var u,d=0,l=0,h=0,f=t.length;h<f;h++)if(o.setUint8(a+h,t[h]),h+1===c){if(d=(u=n[r])._length,l=a+c,u._bin)for(var p=new Uint8Array(u._bin),v=0;v<d;v++)o.setUint8(l+v,p[v]);else u._str?E(o,l,u._str):void 0!==u._float&&o.setFloat64(l,u._float);a+=d,n[++r]&&(c=n[r]._offset)}return s}I.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},I.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},I.prototype._str=function(e){var t=function(e,t,n){for(var i="",s=0,o=t,r=t+n;o<r;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(s=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)>=65536?(s-=65536,i+=String.fromCharCode(55296+(s>>>10),56320+(1023&s))):i+=String.fromCharCode(s)}else i+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else i+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else i+=String.fromCharCode(a)}return i}(this._view,this._offset,e);return this._offset+=e,t},I.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},I.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,i=0,s=0,o=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:return n=this._view.getUint8(this._offset),i=this._view.getInt8(this._offset+1),this._offset+=2,[i,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),i=this._view.getInt8(this._offset+2),this._offset+=3,[i,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),i=this._view.getInt8(this._offset+4),this._offset+=5,[i,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return s=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,s+o;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return s=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,s+o;case 212:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?void(this._offset+=1):[i,this._bin(1)];case 213:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(2)];case 214:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(4)];case 215:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?(s=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(s+o)):[i,this._bin(8)];case 216:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")};var b,A,S=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},C=function(){function e(e){this.events=e}return e.prototype.send=function(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)},e.prototype.connect=function(e){this.ws=new S(e,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},e.prototype.close=function(e,t){this.ws.close(e,t)},e}(),O=function(){function e(){this.events={},this.transport=new C(this.events)}return e.prototype.send=function(e){this.transport.send(e)},e.prototype.connect=function(e){this.transport.connect(e)},e.prototype.close=function(e,t){this.transport.close(e,t)},e}(),k={};function P(e,t){k[e]=t}function N(e){var t=k[e];if(!t)throw new Error("missing serializer: "+e);return t}e.Protocol=void 0,(b=e.Protocol||(e.Protocol={}))[b.HANDSHAKE=9]="HANDSHAKE",b[b.JOIN_ROOM=10]="JOIN_ROOM",b[b.ERROR=11]="ERROR",b[b.LEAVE_ROOM=12]="LEAVE_ROOM",b[b.ROOM_DATA=13]="ROOM_DATA",b[b.ROOM_STATE=14]="ROOM_STATE",b[b.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",b[b.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e.ErrorCode=void 0,(A=e.ErrorCode||(e.ErrorCode={}))[A.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",A[A.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",A[A.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",A[A.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",A[A.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",A[A.AUTH_FAILED=4215]="AUTH_FAILED",A[A.APPLICATION_ERROR=4216]="APPLICATION_ERROR";let _=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}});var L=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return this.handlers.push(e),this},e.prototype.invoke=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.handlers.forEach((function(n){return n.apply(e,t)}))},e.prototype.invokeAsync=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.all(this.handlers.map((function(n){return n.apply(e,t)})))},e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}();function D(){var e=new L;function t(t){return e.register(t,null===this)}return t.once=function(t){var n=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];t.apply(this,i),e.remove(n)};e.register(n)},t.remove=function(t){return e.remove(t)},t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)},t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)},t.clear=function(){return e.clear()},t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var x,R=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e,t){!function(e){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function i(e,t,n,i){var s,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,n,r):s(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r}function s(e,t){for(var n=0,i=t.length,s=e.length;n<i;n++,s++)e[s]=t[n];return e}var o,r=255,a=213;e.OPERATION=void 0,(o=e.OPERATION||(e.OPERATION={}))[o.ADD=128]="ADD",o[o.REPLACE=0]="REPLACE",o[o.DELETE=64]="DELETE",o[o.DELETE_AND_ADD=192]="DELETE_AND_ADD",o[o.TOUCH=1]="TOUCH",o[o.CLEAR=10]="CLEAR";var c=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(e,t,n){void 0===n&&(n=!0),this.refs.set(e,t),n&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach((function(t){if(e.refCounts[t]<=0){var n=e.refs.get(t);if(n instanceof Oe)for(var i in n._definition.schema)"string"!=typeof n._definition.schema[i]&&n[i]&&n[i].$changes&&e.removeRef(n[i].$changes.refId);else{var s=n.$changes.parent._definition,o=s.schema[s.fieldsByIndex[n.$changes.parentIndex]];"function"==typeof Object.values(o)[0]&&Array.from(n.values()).forEach((function(t){return e.removeRef(t.$changes.refId)}))}e.refs.delete(t),delete e.refCounts[t]}})),this.deletedRefs.clear()},e}(),u=function(){function t(e,t,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(t,n)}return t.prototype.setParent=function(e,t,n){var i=this;if(this.indexes||(this.indexes=this.ref instanceof Oe?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=n,t)if(this.root=t,this.ref instanceof Oe){var s=this.ref._definition;for(var o in s.schema){var r=this.ref[o];if(r&&r.$changes){var a=s.indexes[o];r.$changes.setParent(this.ref,t,a)}}}else"object"==typeof this.ref&&this.ref.forEach((function(e,t){if(e instanceof Oe){var n=e.$changes,s=i.ref.$changes.indexes[t];n.setParent(i.ref,i.root,s)}}))},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(t,n){void 0===n&&(n=e.OPERATION.ADD);var i="number"==typeof t?t:this.indexes[t];this.assertValidIndex(i,t);var s=this.changes.get(i);s&&s.op!==e.OPERATION.DELETE&&s.op!==e.OPERATION.TOUCH||this.changes.set(i,{op:s&&s.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:n,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},t.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t),this.changes.has(n)||this.changes.set(n,{op:e.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition)return(t=this.ref._definition).schema[t.fieldsByIndex[e]];var t,n=(t=this.parent._definition).schema[t.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0!==n){var i=this.getValue(n);this.changes.set(n,{op:e.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],i&&i.$changes&&(i.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+t+" ("+n+")")},t.prototype.discard=function(t,n){var i=this;void 0===t&&(t=!1),void 0===n&&(n=!1),this.ref instanceof Oe||this.changes.forEach((function(t){if(t.op===e.OPERATION.DELETE){var n=i.ref.getIndex(t.index);delete i.indexes[n]}})),this.changes.clear(),this.changed=t,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach((function(t){var n=e.getValue(t.index);n&&n.$changes&&n.$changes.discardAll()})),this.discard()},t.prototype.cache=function(e,t){this.caches[e]=t},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,t){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+t+'"')},t}(),d=function(e,t){var n=e.toString(),i=t.toString();return n<i?-1:n>i?1:0};function l(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"==typeof t||isNaN(t)?e[t]:e.at(t)},set:function(e,t,n){if("symbol"==typeof t||isNaN(t))e[t]=n;else{var i=Array.from(e.$items.keys()),s=parseInt(i[t]||t);null==n?e.deleteAt(s):e.setAt(s,n)}return!0},deleteProperty:function(e,t){return"number"==typeof t?e.deleteAt(t):delete e[t],!0}})}var h=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e,t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return n.forEach((function(n){e=t.$refId++,t.setAt(e,n)})),e},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var t=this.$items.get(e);return this.$items.delete(e),t}},t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},t.prototype.setAt=function(t,n){var i,s;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,t);var o=null!==(s=null===(i=this.$changes.indexes[t])||void 0===i?void 0:i.op)&&void 0!==s?s:e.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,n),this.$changes.change(t,o)},t.prototype.deleteAt=function(e){var t=Array.from(this.$items.keys())[e];return void 0!==t&&this.$deleteAt(t)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e.$changes.refId)})),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(t.bind.apply(t,s([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n))))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,t=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(n,i){e.setAt(t[i],n)})),this},t.prototype.shift=function(){var e=Array.from(this.$items.keys()).shift();if(void 0!==e){var t=this.$items.get(e);return this.$deleteAt(e),t}},t.prototype.slice=function(e,n){return new(t.bind.apply(t,s([void 0],Array.from(this.$items.values()).slice(e,n))))},t.prototype.sort=function(e){var t=this;void 0===e&&(e=d);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach((function(e,i){t.setAt(n[i],e)})),this},t.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var n=Array.from(this.$items.keys()),i=[],s=e;s<e+t;s++)i.push(this.$items.get(n[s])),this.$deleteAt(n[s]);return i},t.prototype.unshift=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.length,s=t.length,o=Array.from(this.$items.values());return t.forEach((function(t,n){e.setAt(n,t)})),o.forEach((function(t,n){e.setAt(s+n,t)})),i+s},t.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)},t.prototype.lastIndexOf=function(e,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,t)},t.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)},t.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)},t.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)},t.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)},t.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)},t.prototype.reduce=function(e,t){return Array.from(this.$items.values()).reduce(e,t)},t.prototype.reduceRight=function(e,t){return Array.from(this.$items.values()).reduceRight(e,t)},t.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)},t.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)},t.prototype.fill=function(e,t,n){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,t,n){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},t.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)},t.prototype.flatMap=function(e,t){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map((function(e){return"function"==typeof e.toJSON?e.toJSON():e}))},t.prototype.clone=function(e){return e?new(t.bind.apply(t,s([void 0],Array.from(this.$items.values())))):new(t.bind.apply(t,s([void 0],this.map((function(e){return e.$changes?e.clone():e})))))},t.prototype.triggerAll=function(){Oe.prototype.triggerAll.apply(this)},t}();function f(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"!=typeof t&&void 0===e[t]?e.get(t):e[t]},set:function(e,t,n){return"symbol"!=typeof t&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,n):e[t]=n,!0},deleteProperty:function(e,t){return e.delete(t),!0}})}var p=function(){function t(e){var t=this;if(this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach((function(e,n){return t.set(n,e)}));else for(var n in e)this.set(n,e[n])}return t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),t.prototype.set=function(t,n){if(null==n)throw new Error("MapSchema#set('"+t+"', "+n+"): trying to set "+n+" value on '"+t+"'.");var i=void 0!==this.$changes.indexes[t],s=i?this.$changes.indexes[t]:this.$refId++,o=i?e.OPERATION.REPLACE:e.OPERATION.ADD,r=void 0!==n.$changes;return r&&n.$changes.setParent(this,this.$changes.root,s),i?r&&this.$items.get(t)!==n&&(o=e.OPERATION.ADD):(this.$changes.indexes[t]=s,this.$indexes.set(s,t)),this.$items.set(t,n),this.$changes.change(t,o),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e.$changes.refId)})),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach((function(t,n){e[n]="function"==typeof t.toJSON?t.toJSON():t})),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach((function(e,t){e.$changes?n.set(t,e.clone()):n.set(t,e)}))),n},t.prototype.triggerAll=function(){Oe.prototype.triggerAll.apply(this)},t}(),v={};function g(e,t){v[e]=t}function m(e){return v[e]}var y=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(t){var n=new e;return n.schema=Object.assign({},t&&t.schema||{}),n.indexes=Object.assign({},t&&t.indexes||{}),n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),n.descriptors=Object.assign({},t&&t.descriptors||{}),n.deprecated=Object.assign({},t&&t.deprecated||{}),n},e.prototype.addField=function(e,t){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=e,this.indexes[e]=n,this.schema[e]=Array.isArray(t)?{array:t[0]}:t},e.prototype.addFilter=function(e,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=t,this.indexesWithFilters.push(this.indexes[e]),!0},e.prototype.addChildrenFilter=function(e,t){var n=this.indexes[e],i=this.schema[e];if(m(Object.keys(i)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=t,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}();function I(e){return e._context&&e._context.useFilters}var E=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size),e._definition=y.create(e._definition),e._typeid=t,this.types[t]=e,this.schemas.set(e,t)},e.create=function(t){return void 0===t&&(t=new e),function(e){return T(e,t)}},e}(),w=new E;function T(e,t){return void 0===t&&(t=w),function(n,i){var o=n.constructor;o._context=t,t.has(o)||t.add(o);var r=o._definition;if(r.addField(i,e),r.descriptors[i]){if(r.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+o.name+"'.\nCheck @type() annotation")}catch(e){var a=e.stack.split("\n")[4].trim();throw new Error(e.message+" "+a)}}var c=h.is(e),u=!c&&p.is(e);if("string"!=typeof e&&!Oe.is(e)){var d=Object.values(e)[0];"string"==typeof d||t.has(d)||t.add(d)}var v="_"+i;r.descriptors[v]={enumerable:!1,configurable:!1,writable:!0},r.descriptors[i]={get:function(){return this[v]},set:function(e){e!==this[v]&&(null!=e?(!c||e instanceof h||(e=new(h.bind.apply(h,s([void 0],e)))),!u||e instanceof p||(e=new p(e)),void 0===e.$proxy&&(u?e=f(e):c&&(e=l(e))),this.$changes.change(i),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this.$changes.delete(i),this[v]=e)},enumerable:!0,configurable:!0}}}function b(e){return function(t,n){var i=t.constructor;i._definition.addFilter(n,e)&&(i._context.useFilters=!0)}}function A(e){return function(t,n){var i=t.constructor;i._definition.addChildrenFilter(n,e)&&(i._context.useFilters=!0)}}function S(e,t){return void 0===e&&(e=!0),function(t,n){var i=t.constructor._definition;i.deprecated[n]=!0,e&&(i.descriptors[n]={get:function(){throw new Error(n+" is deprecated.")},set:function(e){},enumerable:!1,configurable:!0})}}function C(e,t,n){for(var i in void 0===n&&(n=e._context||w),t)T(t[i],n)(e.prototype,i);return e}function O(e){for(var t=0,n=0,i=0,s=e.length;i<s;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}function k(e,t,n){for(var i=0,s=0,o=n.length;s<o;s++)(i=n.charCodeAt(s))<128?e[t++]=i:i<2048?(e[t++]=192|i>>6,e[t++]=128|63&i):i<55296||i>=57344?(e[t++]=224|i>>12,e[t++]=128|i>>6&63,e[t++]=128|63&i):(s++,i=65536+((1023&i)<<10|1023&n.charCodeAt(s)),e[t++]=240|i>>18,e[t++]=128|i>>12&63,e[t++]=128|i>>6&63,e[t++]=128|63&i)}function P(e,t){e.push(255&t)}function N(e,t){e.push(255&t)}function _(e,t){e.push(255&t),e.push(t>>8&255)}function L(e,t){e.push(255&t),e.push(t>>8&255)}function D(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function x(e,t){var n=t>>24,i=t>>16,s=t>>8,o=t;e.push(255&o),e.push(255&s),e.push(255&i),e.push(255&n)}function R(e,t){var n=Math.floor(t/Math.pow(2,32));x(e,t>>>0),x(e,n)}function M(e,t){var n=t/Math.pow(2,32)>>0;x(e,t>>>0),x(e,n)}function $(e,t){W(e,t)}function V(e,t){F(e,t)}var U=new Int32Array(2),G=new Float32Array(U.buffer),B=new Float64Array(U.buffer);function W(e,t){G[0]=t,D(e,U[0])}function F(e,t){B[0]=t,D(e,U[0]),D(e,U[1])}function H(e,t){return N(e,t?1:0)}function j(e,t){t||(t="");var n=O(t),i=0;if(n<32)e.push(160|n),i=1;else if(n<256)e.push(217),N(e,n),i=2;else if(n<65536)e.push(218),L(e,n),i=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219),x(e,n),i=5}return k(e,e.length,t),i+n}function z(e,t){return isNaN(t)?z(e,0):isFinite(t)?t!==(0|t)?(e.push(203),F(e,t),9):t>=0?t<128?(N(e,t),1):t<256?(e.push(204),N(e,t),2):t<65536?(e.push(205),L(e,t),3):t<4294967296?(e.push(206),x(e,t),5):(e.push(207),M(e,t),9):t>=-32?(e.push(224|t+32),1):t>=-128?(e.push(208),P(e,t),2):t>=-32768?(e.push(209),_(e,t),3):t>=-2147483648?(e.push(210),D(e,t),5):(e.push(211),R(e,t),9):z(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var K=Object.freeze({__proto__:null,utf8Write:k,int8:P,uint8:N,int16:_,uint16:L,int32:D,uint32:x,int64:R,uint64:M,float32:$,float64:V,writeFloat32:W,writeFloat64:F,boolean:H,string:j,number:z});function Y(e,t,n){for(var i="",s=0,o=t,r=t+n;o<r;o++){var a=e[o];0!=(128&a)?192!=(224&a)?224!=(240&a)?240!=(248&a)?console.error("Invalid byte "+a.toString(16)):(s=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536?(s-=65536,i+=String.fromCharCode(55296+(s>>>10),56320+(1023&s))):i+=String.fromCharCode(s):i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0):i+=String.fromCharCode((31&a)<<6|63&e[++o]):i+=String.fromCharCode(a)}return i}function J(e,t){return q(e,t)<<24>>24}function q(e,t){return e[t.offset++]}function X(e,t){return Q(e,t)<<16>>16}function Q(e,t){return e[t.offset++]|e[t.offset++]<<8}function Z(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function ee(e,t){return Z(e,t)>>>0}function te(e,t){return ce(e,t)}function ne(e,t){return ue(e,t)}function ie(e,t){var n=ee(e,t);return Z(e,t)*Math.pow(2,32)+n}function se(e,t){var n=ee(e,t);return ee(e,t)*Math.pow(2,32)+n}var oe=new Int32Array(2),re=new Float32Array(oe.buffer),ae=new Float64Array(oe.buffer);function ce(e,t){return oe[0]=Z(e,t),re[0]}function ue(e,t){return oe[0]=Z(e,t),oe[1]=Z(e,t),ae[0]}function de(e,t){return q(e,t)>0}function le(e,t){var n,i=e[t.offset++];i<192?n=31&i:217===i?n=q(e,t):218===i?n=Q(e,t):219===i&&(n=ee(e,t));var s=Y(e,t.offset,n);return t.offset+=n,s}function he(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n}function fe(e,t){var n=e[t.offset++];return n<128?n:202===n?ce(e,t):203===n?ue(e,t):204===n?q(e,t):205===n?Q(e,t):206===n?ee(e,t):207===n?se(e,t):208===n?J(e,t):209===n?X(e,t):210===n?Z(e,t):211===n?ie(e,t):n>223?-1*(255-n+1):void 0}function pe(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211}function ve(e,t){return e[t.offset]<160}function ge(e,t){return e[t.offset-1]===r&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var me=Object.freeze({__proto__:null,int8:J,uint8:q,int16:X,uint16:Q,int32:Z,uint32:ee,float32:te,float64:ne,int64:ie,uint64:se,readFloat32:ce,readFloat64:ue,boolean:de,string:le,stringCheck:he,number:fe,numberCheck:pe,arrayCheck:ve,switchStructureCheck:ge}),ye=function(){function t(e){var t=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return t.add(e)}))}return t.is=function(e){return void 0!==e.collection},t.prototype.add=function(e){var t=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t),t},t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e.$changes.refId)})),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some((function(t){return t===e}))},t.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,i,s){return e(n,i,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach((function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)})),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach((function(e){e.$changes?n.add(e.clone()):n.add(e)}))),n},t.prototype.triggerAll=function(){Oe.prototype.triggerAll.apply(this)},t}(),Ie=function(){function t(e){var t=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return t.add(e)}))}return t.is=function(e){return void 0!==e.set},t.prototype.add=function(t){var n,i;if(this.has(t))return!1;var s=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,s);var o=null!==(i=null===(n=this.$changes.indexes[s])||void 0===n?void 0:n.op)&&void 0!==i?i:e.OPERATION.ADD;return this.$changes.indexes[s]=s,this.$indexes.set(s,s),this.$items.set(s,t),this.$changes.change(s,o),s},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){n.$changes.root.removeRef(e.$changes.refId)})),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var t,n=this.$items.values(),i=!1;(t=n.next())&&!t.done;)if(e===t.value){i=!0;break}return i},t.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,i,s){return e(n,i,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach((function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)})),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach((function(e){e.$changes?n.add(e.clone()):n.add(e)}))),n},t.prototype.triggerAll=function(){Oe.prototype.triggerAll.apply(this)},t}(),Ee=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return this.handlers.push(e),this},e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,e)}))},e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,e)})))},e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}(),we=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},e.get=function(t){return void 0===t.$filterState&&(t.$filterState=new e),t.$filterState},e}(),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(Error);function be(e,t,n,i){var s,o=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":s="number",isNaN(e)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+i);break;case"string":s="string",o=!0;break;case"boolean":return}if(typeof e!==s&&(!o||o&&null!==e)){var r="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")"||"");throw new Te("a '"+s+"' was expected, but "+r+" was provided in "+n.constructor.name+"#"+i)}}function Ae(e,t,n,i){if(!(e instanceof t))throw new Te("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+i)}function Se(e,t,n,i,s){be(n,e,i,s);var o=K[e];if(!o)throw new Te("a '"+e+"' was expected, but "+n+" was provided in "+i.constructor.name+"#"+s);o(t,n)}function Ce(e,t,n){return me[e](t,n)}var Oe=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new u(this,void 0,new c),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&void 0!==e._definition.schema},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.listen=function(e,t){var n=this;return this.$listeners[e]||(this.$listeners[e]=new Ee),this.$listeners[e].register(t),function(){return n.$listeners[e].remove(t)}},t.prototype.decode=function(n,i,s,o){void 0===i&&(i={offset:0}),void 0===s&&(s=this),void 0===o&&(o=new Map);var a=this.$changes.root,c=n.length,u=0,d=[];for(a.refs.set(u,this),o.set(u,d);i.offset<c;){var l=n[i.offset++];if(l!=r){var f=s.$changes,v=void 0!==s._definition,g=v?l>>6<<6:l;if(g!==e.OPERATION.CLEAR){var y=v?l%(g||255):fe(n,i),I=v?s._definition.fieldsByIndex[y]:"",E=f.getType(y),w=void 0,T=void 0,b=void 0;if(v?T=s["_"+I]:(T=s.getByIndex(y),(g&e.OPERATION.ADD)===e.OPERATION.ADD?(b=s instanceof p?le(n,i):y,s.setIndex(y,b)):b=s.getIndex(y)),(g&e.OPERATION.DELETE)===e.OPERATION.DELETE&&(g!==e.OPERATION.DELETE_AND_ADD&&s.deleteByIndex(y),T&&T.$changes&&a.removeRef(T.$changes.refId),w=null),void 0!==I){if(g===e.OPERATION.DELETE);else if(t.is(E)){var A=fe(n,i);if(w=a.refs.get(A),g!==e.OPERATION.REPLACE){var S=this.getSchemaType(n,i,E);w||((w=this.createTypeInstance(S)).$changes.refId=A,T&&(w.onChange=T.onChange,w.onRemove=T.onRemove,w.$listeners=T.$listeners,T.$changes.refId&&A!==T.$changes.refId&&a.removeRef(T.$changes.refId))),a.addRef(A,w,w!==T)}}else if("string"==typeof E)w=Ce(E,n,i);else{var C=m(Object.keys(E)[0]),O=fe(n,i),k=a.refs.has(O)?T||a.refs.get(O):new C.constructor;if((w=k.clone(!0)).$changes.refId=O,T&&(w.onAdd=T.onAdd,w.onRemove=T.onRemove,w.onChange=T.onChange,T.$changes.refId&&O!==T.$changes.refId)){a.removeRef(T.$changes.refId);for(var P=[],N=T.entries(),_=void 0;(_=N.next())&&!_.done;){var L=_.value,D=L[0],x=L[1];P.push({op:e.OPERATION.DELETE,field:D,value:void 0,previousValue:x})}o.set(T.$changes.refId,P)}a.addRef(O,w,k!==T),C.getProxy&&(w=C.getProxy(w))}var R=T!==w;if(null!=w)if(w.$changes&&w.$changes.setParent(f.ref,f.root,y),s instanceof t)s[I]=w;else if(s instanceof p)D=b,s.$items.set(D,w);else if(s instanceof h)s.setAt(y,w);else if(s instanceof ye){var M=s.add(w);s.setIndex(y,M)}else s instanceof Ie&&!1!==(M=s.add(w))&&s.setIndex(y,M);R&&d.push({op:g,field:I,dynamicIndex:b,value:w,previousValue:T})}else{console.warn("@colyseus/schema: definition mismatch");for(var $={offset:i.offset};i.offset<c&&(!ge(n,i)||($.offset=i.offset+1,!a.refs.has(fe(n,$))));)i.offset++}}else s.clear(!0)}else{u=fe(n,i);var V=a.refs.get(u);if(!V)throw new Error('"refId" not found: '+u);s=V,d=[],o.set(u,d)}}return this._triggerChanges(o),a.garbageCollectDeletedRefs(),o},t.prototype.encode=function(n,i,s){void 0===n&&(n=!1),void 0===i&&(i=[]),void 0===s&&(s=!1);for(var o=this.$changes,a=new WeakSet,c=[o],u=1,d=0;d<u;d++){var l=c[d],h=l.ref,f=h instanceof t;l.ensureRefId(),a.add(l),l!==o&&(l.changed||n)&&(N(i,r),z(i,l.refId));for(var v=n?Array.from(l.allChanges):Array.from(l.changes.values()),g=0,y=v.length;g<y;g++){var I=n?{op:e.OPERATION.ADD,index:v[g]}:v[g],E=I.index,w=f?h._definition.fieldsByIndex&&h._definition.fieldsByIndex[E]:E,T=i.length;if(I.op!==e.OPERATION.TOUCH)if(f)N(i,E|I.op);else{if(N(i,I.op),I.op===e.OPERATION.CLEAR)continue;z(i,E)}if(f||(I.op&e.OPERATION.ADD)!=e.OPERATION.ADD||h instanceof p&&j(i,l.ref.$indexes.get(E)),I.op!==e.OPERATION.DELETE){var b=l.getType(E),A=l.getValue(E);if(A&&A.$changes&&!a.has(A.$changes)&&(c.push(A.$changes),A.$changes.ensureRefId(),u++),I.op!==e.OPERATION.TOUCH){if(t.is(b))Ae(A,b,h,w),z(i,A.$changes.refId),(I.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(i,b,A.constructor);else if("string"==typeof b)Se(b,i,A,h,w);else{var S=m(Object.keys(b)[0]);Ae(h["_"+w],S.constructor,h,w),z(i,A.$changes.refId)}s&&l.cache(E,i.slice(T))}}}n||s||l.discard()}return i},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(n,i){var s,o;void 0===i&&(i=!1);for(var a=this,c=new Set,u=we.get(n),d=[this.$changes],l=1,h=[],f=function(f){var v=d[f];if(c.has(v.refId))return"continue";var g=v.ref,m=g instanceof t;N(h,r),z(h,v.refId);var y=u.refIds.has(v),I=i||!y;u.addRefId(v);var E=u.containerIndexes.get(v),w=I?Array.from(v.allChanges):Array.from(v.changes.values());!i&&m&&g._definition.indexesWithFilters&&g._definition.indexesWithFilters.forEach((function(t){!E.has(t)&&v.allChanges.has(t)&&(I?w.push(t):w.push({op:e.OPERATION.ADD,index:t}))}));for(var T=0,b=w.length;T<b;T++){var A=I?{op:e.OPERATION.ADD,index:w[T]}:w[T];if(A.op!==e.OPERATION.CLEAR){var S=A.index;if(A.op!==e.OPERATION.DELETE){var C=v.getValue(S),O=v.getType(S);if(m){if((k=g._definition.filters&&g._definition.filters[S])&&!k.call(g,n,C,a)){C&&C.$changes&&c.add(C.$changes.refId);continue}}else{var k,P=v.parent;if((k=v.getChildrenFilter())&&!k.call(P,n,g.$indexes.get(S),C,a)){C&&C.$changes&&c.add(C.$changes.refId);continue}}if(C.$changes&&(d.push(C.$changes),l++),A.op!==e.OPERATION.TOUCH)if(A.op===e.OPERATION.ADD||m)h.push.apply(h,null!==(s=v.caches[S])&&void 0!==s?s:[]),E.add(S);else if(E.has(S))h.push.apply(h,null!==(o=v.caches[S])&&void 0!==o?o:[]);else{if(E.add(S),N(h,e.OPERATION.ADD),z(h,S),g instanceof p){var _=v.ref.$indexes.get(S);j(h,_)}C.$changes?z(h,C.$changes.refId):K[O](h,C)}else C.$changes&&!m&&(N(h,e.OPERATION.ADD),z(h,S),g instanceof p&&(_=v.ref.$indexes.get(S),j(h,_)),z(h,C.$changes.refId))}else m?N(h,A.op|S):(N(h,A.op),z(h,S))}else N(h,A.op)}},v=0;v<l;v++)f(v);return h},t.prototype.clone=function(){var e=new this.constructor,t=this._definition.schema;for(var n in t)"object"==typeof this[n]&&"function"==typeof this[n].clone?e[n]=this[n].clone():e[n]=this[n];return e},t.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;t.prototype._triggerAllFillChanges.call(this,this,e);try{t.prototype._triggerChanges.call(this,e)}catch(e){t.onError(e)}}},t.prototype.toJSON=function(){var e=this._definition.schema,t=this._definition.deprecated,n={};for(var i in e)t[i]||null===this[i]||void 0===this[i]||(n[i]="function"==typeof this[i].toJSON?this[i].toJSON():this["_"+i]);return n},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,t,n){t._typeid!==n._typeid&&(N(e,a),z(e,n._typeid))},t.prototype.getSchemaType=function(e,t,n){var i;return e[t.offset]===a&&(t.offset++,i=this.constructor._context.get(fe(e,t))),i||n},t.prototype.createTypeInstance=function(e){var t=new e;return t.$changes.root=this.$changes.root,t},t.prototype._triggerAllFillChanges=function(n,i){if(!i.has(n.$changes.refId)){var s=[];if(i.set(n.$changes.refId||0,s),n instanceof t){var o=n._definition.schema;for(var r in o)void 0!==(l=n["_"+r])&&(s.push({op:e.OPERATION.ADD,field:r,value:l,previousValue:void 0}),void 0!==l.$changes&&t.prototype._triggerAllFillChanges.call(this,l,i))}else for(var a=n.entries(),c=void 0;(c=a.next())&&!c.done;){var u=c.value,d=u[0],l=u[1];s.push({op:e.OPERATION.ADD,field:d,dynamicIndex:d,value:l,previousValue:void 0}),void 0!==l.$changes&&t.prototype._triggerAllFillChanges.call(this,l,i)}}},t.prototype._triggerChanges=function(n){var i=this;n.forEach((function(n,s){var o,r,a,c,u,d,l,h,f,p,v,g;if(n.length>0){for(var m=i.$changes.root.refs.get(s),y=m instanceof t,I=0;I<n.length;I++){var E=n[I],w=m.$listeners&&m.$listeners[E.field];if(y||(E.op===e.OPERATION.ADD&&void 0===E.previousValue?null===(r=(o=m).onAdd)||void 0===r||r.call(o,E.value,null!==(a=E.dynamicIndex)&&void 0!==a?a:E.field):E.op===e.OPERATION.DELETE?void 0!==E.previousValue&&(null===(u=(c=m).onRemove)||void 0===u||u.call(c,E.previousValue,null!==(d=E.dynamicIndex)&&void 0!==d?d:E.field)):E.op===e.OPERATION.DELETE_AND_ADD?(void 0!==E.previousValue&&(null===(h=(l=m).onRemove)||void 0===h||h.call(l,E.previousValue,E.dynamicIndex)),null===(p=(f=m).onAdd)||void 0===p||p.call(f,E.value,E.dynamicIndex)):E.op!==e.OPERATION.REPLACE&&E.value===E.previousValue||null===(g=(v=m).onChange)||void 0===g||g.call(v,E.value,E.dynamicIndex)),(E.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&E.previousValue instanceof t&&E.previousValue.onRemove&&E.previousValue.onRemove(),w)try{w.invoke(E.value,E.previousValue)}catch(e){t.onError(e)}}if(y&&m.onChange)try{m.onChange(n)}catch(e){t.onError(e)}}}))},t._definition=y.create(),t}();function ke(e){for(var t=[e.$changes],n=1,i={},s=i,o=function(e){var n=t[e];n.changes.forEach((function(e){var t=n.ref,i=e.index,o=t._definition?t._definition.fieldsByIndex[i]:t.$indexes.get(i);s[o]=n.getValue(i)}))},r=0;r<n;r++)o(r);return i}var Pe=new E,Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),i([T("string",Pe)],t.prototype,"name",void 0),i([T("string",Pe)],t.prototype,"type",void 0),i([T("number",Pe)],t.prototype,"referencedType",void 0),t}(Oe),_e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new h,t}return n(t,e),i([T("number",Pe)],t.prototype,"id",void 0),i([T([Ne],Pe)],t.prototype,"fields",void 0),t}(Oe),Le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new h,t}return n(t,e),t.encode=function(e){var n=e.constructor,i=new t;i.rootType=n._typeid;var s=function(e,t){for(var n in t){var s=new Ne;s.name=n;var o=void 0;if("string"==typeof t[n])o=t[n];else{var r=t[n],a=void 0;Oe.is(r)?(o="ref",a=t[n]):"string"==typeof r[o=Object.keys(r)[0]]?o+=":"+r[o]:a=r[o],s.referencedType=a?a._typeid:-1}s.type=o,e.fields.push(s)}i.types.push(e)},o=n._context.types;for(var r in o){var a=new _e;a.id=Number(r),s(a,o[r]._definition.schema)}return i.encodeAll()},t.decode=function(e,i){var s=new E,o=new t;o.decode(e,i);var r=o.types.reduce((function(e,t){var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(Oe),o=t.id;return e[o]=i,s.add(i,o),e}),{});o.types.forEach((function(e){var t=r[e.id];e.fields.forEach((function(e){var n;if(void 0!==e.referencedType){var i=e.type,o=r[e.referencedType];if(!o){var a=e.type.split(":");i=a[0],o=a[1]}"ref"===i?T(o,s)(t.prototype,e.name):T(((n={})[i]=o,n),s)(t.prototype,e.name)}else T(e.type,s)(t.prototype,e.name)}))}));var a=r[o.rootType],c=new a;for(var u in a._definition.schema){var d=a._definition.schema[u];"string"!=typeof d&&(c[u]="function"==typeof d?new d:new(m(Object.keys(d)[0]).constructor))}return c},i([T([_e],Pe)],t.prototype,"types",void 0),i([T("number",Pe)],t.prototype,"rootType",void 0),t}(Oe);g("map",{constructor:p,getProxy:f}),g("array",{constructor:h,getProxy:l}),g("set",{constructor:Ie}),g("collection",{constructor:ye}),e.ArraySchema=h,e.CollectionSchema=ye,e.Context=E,e.MapSchema=p,e.Reflection=Le,e.ReflectionField=Ne,e.ReflectionType=_e,e.Schema=Oe,e.SchemaDefinition=y,e.SetSchema=Ie,e.decode=me,e.defineTypes=C,e.deprecated=S,e.dumpChanges=ke,e.encode=K,e.filter=b,e.filterChildren=A,e.hasFilter=I,e.registerType=g,e.type=T,Object.defineProperty(e,"__esModule",{value:!0})}(t)})),M=function(){function t(e,t){var n=this;this.onStateChange=D(),this.onError=D(),this.onLeave=D(),this.onJoin=D(),this.hasJoined=!1,this.onMessageHandlers=_(),this.id=null,this.name=e,t&&(this.serializer=new(N("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((function(e,t){return console.warn("colyseus.js - onError => ("+e+") "+t)})),this.onLeave((function(){return n.removeAllListeners()}))}return t.prototype.connect=function(e){var t=this;this.connection=new O,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(e){if(!t.hasJoined)return console.warn("Room connection was closed unexpectedly ("+e.code+"): "+e.reason),void t.onError.invoke(e.code,e.reason);t.onLeave.invoke(e.code),t.destroy()},this.connection.events.onerror=function(e){console.warn("Room, onError ("+e.code+"): "+e.reason),t.onError.invoke(e.code,e.reason)},this.connection.connect(e)},t.prototype.leave=function(t){var n=this;return void 0===t&&(t=!0),new Promise((function(i){n.onLeave((function(e){return i(e)})),n.connection?t?n.connection.send([e.Protocol.LEAVE_ROOM]):n.connection.close():n.onLeave.invoke(4e3)}))},t.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)},t.prototype.send=function(t,n){var i,s=[e.Protocol.ROOM_DATA];if("string"==typeof t?R.encode.string(s,t):R.encode.number(s,t),void 0!==n){var o=T(n);(i=new Uint8Array(s.length+o.byteLength)).set(new Uint8Array(s),0),i.set(new Uint8Array(o),s.length)}else i=new Uint8Array(s);this.connection.send(i.buffer)},Object.defineProperty(t.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),t.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},t.prototype.onMessageCallback=function(t){var n=Array.from(new Uint8Array(t.data)),i=n[0];if(i===e.Protocol.JOIN_ROOM){var s=1;if(this.serializerId=function(e,t){for(var n=e[t++],i="",s=0,o=t,r=t+n;o<r;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(s=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536?(s-=65536,i+=String.fromCharCode(55296+(s>>>10),56320+(1023&s))):i+=String.fromCharCode(s)}else i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else i+=String.fromCharCode((31&a)<<6|63&e[++o]);else i+=String.fromCharCode(a)}return i}(n,s),s+=function(e){void 0===e&&(e="");for(var t=0,n=0,i=0,s=e.length;i<s;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n+1}(this.serializerId),!this.serializer){var o=N(this.serializerId);this.serializer=new o}n.length>s&&this.serializer.handshake&&this.serializer.handshake(n,{offset:s}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(i===e.Protocol.ERROR){var r={offset:1},a=R.decode.number(n,r),c=R.decode.string(n,r);this.onError.invoke(a,c)}else if(i===e.Protocol.LEAVE_ROOM)this.leave();else if(i===e.Protocol.ROOM_DATA_SCHEMA){var u={offset:1};(c=new(l=this.serializer.getState().constructor._context.get(R.decode.number(n,u)))).decode(n,u),this.dispatchMessage(l,c)}else if(i===e.Protocol.ROOM_STATE)n.shift(),this.setState(n);else if(i===e.Protocol.ROOM_STATE_PATCH)n.shift(),this.patch(n);else if(i===e.Protocol.ROOM_DATA){var d={offset:1},l=R.decode.stringCheck(n,d)?R.decode.string(n,d):R.decode.number(n,d);c=n.length>d.offset?function(e,t){void 0===t&&(t=0);var n=new I(e,t),i=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return i}(t.data,d.offset):void 0,this.dispatchMessage(l,c)}},t.prototype.setState=function(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())},t.prototype.patch=function(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())},t.prototype.dispatchMessage=function(e,t){var n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):console.warn("colyseus.js: onMessage() not registered for type '"+e+"'.")},t.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},t.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$"+e._typeid;case"string":return e;case"number":return"i"+e;default:throw new Error("invalid message type.")}},t}();function $(){return x||(x="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),x}var V,U="colyseus-auth-token";e.Platform=void 0,(V=e.Platform||(e.Platform={})).ios="ios",V.android="android";var G,B=function(){function e(e){var t,n,i,s=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=e.replace("ws","http"),t=U,n=function(e){return s.token=e},i=$().getItem(t),"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return n(e)})):n(i)}return Object.defineProperty(e.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),e.prototype.login=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,n,i;return s(this,(function(s){switch(s.label){case 0:return t=Object.assign({},e),this.hasToken&&(t.token=this.token),[4,this.request("post","/auth",t)];case 1:for(i in n=s.sent(),this.token=n.token,o=U,r=this.token,$().setItem(o,r),n)this.hasOwnProperty(i)&&(this[i]=n[i]);return this.registerPingService(),[2,this]}var o,r}))}))},e.prototype.save=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return e.sent(),[2,this]}}))}))},e.prototype.getFriends=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}}))}))},e.prototype.getOnlineFriends=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}}))}))},e.prototype.getFriendRequests=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}}))}))},e.prototype.sendFriendRequest=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.acceptFriendRequest=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.declineFriendRequest=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.blockUser=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.unblockUser=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.request=function(e,t,n,o,r){return void 0===n&&(n={}),void 0===r&&(r={}),i(this,void 0,void 0,(function(){var i,a,c,u;return s(this,(function(s){switch(s.label){case 0:for(a in r.Accept="application/json",this.hasToken&&(r.Authorization="Bearer "+this.token),i=[],n)i.push(a+"="+n[a]);return c=i.length>0?"?"+i.join("&"):"",u={headers:r},o&&(u.body=o),[4,m[e](""+this.endpoint+t+c,u)];case 1:return[2,s.sent().data]}}))}))},e.prototype.logout=function(){var e;this.token=void 0,e=U,$().removeItem(e),this.unregisterPingService()},e.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval((function(){return t.request("get","/auth")}),e)},e.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},e}(),W=function(e){function t(n,i){var s=e.call(this,n)||this;return s.code=i,Object.setPrototypeOf(s,t.prototype),s}return n(t,e),t}(Error),F="undefined"!=typeof window&&void 0!==(null===(G=null===window||void 0===window?void 0:window.location)||void 0===G?void 0:G.hostname)?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",H=function(){function e(e){void 0===e&&(e=F),this.endpoint=e}return Object.defineProperty(e.prototype,"auth",{get:function(){return this._auth||(this._auth=new B(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),e.prototype.joinOrCreate=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,i.sent()]}}))}))},e.prototype.create=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,i.sent()]}}))}))},e.prototype.join=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,i.sent()]}}))}))},e.prototype.joinById=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,i.sent()]}}))}))},e.prototype.reconnect=function(e,t,n){return i(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,{sessionId:t},n)];case 1:return[2,i.sent()]}}))}))},e.prototype.getAvailableRooms=function(e){return void 0===e&&(e=""),i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this.endpoint.replace("ws","http")+"/matchmake/"+e,[4,l(t,{headers:{Accept:"application/json"}})];case 1:return[2,n.sent().data]}}))}))},e.prototype.consumeSeatReservation=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(i){return(n=this.createRoom(e.room.name,t)).id=e.room.roomId,n.sessionId=e.sessionId,n.connect(this.buildEndpoint(e.room,{sessionId:n.sessionId})),[2,new Promise((function(e,t){var i=function(e,n){return t(new y(e,n))};n.onError.once(i),n.onJoin.once((function(){n.onError.remove(i),e(n)}))}))]}))}))},e.prototype.createMatchMakeRequest=function(e,t,n,o){return void 0===n&&(n={}),i(this,void 0,void 0,(function(){var i,r;return s(this,(function(s){switch(s.label){case 0:return i=this.endpoint.replace("ws","http")+"/matchmake/"+e+"/"+t,this._auth&&this._auth.hasToken&&(n.token=this._auth.token),[4,f(i,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((r=s.sent().data).error)throw new W(r.error,r.code);return[2,this.consumeSeatReservation(r,o)]}}))}))},e.prototype.createRoom=function(e,t){return new M(e,t)},e.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i+"="+t[i]);return this.endpoint+"/"+e.processId+"/"+e.roomId+"?"+n.join("&")},e}(),j=function(){function e(){}return e.prototype.setState=function(e){this.state.decode(e)},e.prototype.getState=function(){return this.state},e.prototype.patch=function(e){this.state.decode(e)},e.prototype.teardown=function(){var e,t;null===(t=null===(e=this.state)||void 0===e?void 0:e.$changes)||void 0===t||t.root.clearRefs()},e.prototype.handshake=function(e,t){this.state?(new R.Reflection).decode(e,t):this.state=R.Reflection.decode(e,t)},e}(),z=function(){function e(){}return e.prototype.setState=function(e){},e.prototype.getState=function(){return null},e.prototype.patch=function(e){},e.prototype.teardown=function(){},e.prototype.handshake=function(e){},e}();P("schema",j),P("none",z),e.Auth=B,e.Client=H,e.Room=M,e.SchemaSerializer=j,e.registerSerializer=P,Object.defineProperty(e,"__esModule",{value:!0})},n(t)}(0,m.exports);var y,I,E=function(e){function t(t){return e.call(this,t)||this}return c(t,e),t}(m.exports.Client),w=function(e){function t(t){return e.call(this,t)||this}return c(t,e),t}(m.exports.Room);!function(e){e.uiCanvas=new UICanvas;var t=function(t){function n(n,i){var s=t.call(this,e.uiCanvas)||this;return s.vAlign="center",s.hAlign="center",s.fontSize=16,s.color=Color4.White(),s.delay=3,s.outlineColor=Color4.Black(),s.outlineWidth=.125,s.adaptWidth=!0,s.adaptHeight=!0,s.visible=!1,s.init=function(e,t){var n=(null==t?void 0:t.color)||"white",i=null==t?void 0:t.fontSize;if(s.value=e,s.fontSize=i||s.fontSize,n)switch(n.toLowerCase()){case"black":s.color=Color4.Black(),s.outlineColor=Color4.White();break;case"blue":s.color=Color4.Blue();break;case"gray":s.color=Color4.Gray();break;case"green":s.color=Color4.Green();break;case"magenta":s.color=Color4.Magenta();break;case"purple":s.color=Color4.Purple();break;case"red":s.color=Color4.Red();break;case"teal":s.color=Color4.Teal();break;case"yellow":s.color=Color4.Yellow();break;default:s.color=Color4.White()}},s.init(n,i),s}return c(n,t),n}(UIText);e.Message=t}(y||(y={})),function(e){e[e.HIDDEN=0]="HIDDEN",e[e.FADING_IN=1]="FADING_IN",e[e.FADING_OUT=2]="FADING_OUT",e[e.VISIBLE=3]="VISIBLE"}(I||(I={}));var T=function(){function e(){}var t;return e.update=function(e){var t;if(null===(t=this.messageQueue)||void 0===t?void 0:t.length){var n=this.messageQueue[0];switch(this.state){case I.HIDDEN:this.fadeIn();break;case I.VISIBLE:this.timer+=e,this.timer>=this.delay&&this.fadeOut();break;case I.FADING_IN:n.opacity+=this.fadeSpeed*e,n.opacity>=1&&(n.opacity=1,this.state=I.VISIBLE,this.timer=0,this.delay=n.delay||1);break;case I.FADING_OUT:n.opacity-=this.fadeSpeed*e,n.opacity<=0&&(n.opacity=0,this.removeMessage(),this.state=(this.messageQueue.length,I.HIDDEN))}}},t=e,e.messageQueue=[],e.timer=0,e.state=I.HIDDEN,e.delay=1,e.fadeSpeed=5,e.init=function(e,n){engine.addSystem(t),t.initialized=!0},e.addMessage=function(e,n){t.initialized||t.init();var i=new y.Message(e,n);t.messageQueue.push(i)},e.removeMessage=function(){var e=t.messageQueue.shift();e&&(e.visible=!1)},e.fadeIn=function(){t.state=I.FADING_IN,t.messageQueue[0].opacity=0,t.messageQueue[0].visible=!0},e.fadeOut=function(){t.state=I.FADING_OUT},e}(),b=function(){function e(){}var o;return o=e,e.eventsBound=!1,e.platformData={},e.events=new EventManager,e.start=function(e){return h(void 0,void 0,void 0,(function(){var t,n,i,s,r;return f(o,(function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.platformData.vlmVersion=e,[4,this.getPlatformData()];case 1:return o.sent(),this.client=new E(g.wssUrl),this.sceneRoom=new w("vlm_scene"),[4,this.requestToken()];case 2:return t=o.sent(),n=t.session,i=t.user,this.sessionData=n,this.sessionUser=i,this.sessionData?(s=this,[4,this.joinRelayRoom(this.sessionData)]):[3,4];case 3:s.sceneRoom=o.sent(),o.label=4;case 4:return[2,{sceneRoom:this.sceneRoom,sessionData:this.sessionData}];case 5:throw r=o.sent(),log("VLM CONNECTION ERROR! :",r,this.sceneRoom),r;case 6:return[2]}}))}))},e.end=function(){return h(void 0,void 0,void 0,(function(){return f(o,(function(e){return this.sceneRoom&&(this.sceneRoom.send("session_end",{session:this.sessionData}),this.sceneRoom.leave(!0)),[2]}))}))},e.requestToken=function(){return h(void 0,void 0,void 0,(function(){var e,t,i,s;return f(o,(function(o){switch(o.label){case 0:e=JSON.stringify(u({},this.platformData)),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,n.signedFetch("".concat(g.apiUrl,"/auth/decentraland"),{method:"POST",headers:{"Content-Type":"application/json"},body:e})];case 2:return t=o.sent(),i=void 0,t.text&&(i=JSON.parse(t.text)),[2,i];case 3:throw s=o.sent(),T.addMessage("There was a problem loading this scene...please try to refresh. An error has been logged."),s;case 4:return[2]}}))}))},e.joinRelayRoom=function(e){return h(void 0,void 0,void 0,(function(){var t,n;return f(o,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),log("VLM: Attempting to join the relay room"),this.client=new E(g.wssUrl),log("VLM Cient:",this.client),[4,this.client.joinOrCreate("vlm_scene",u(u({},this.platformData),e))];case 1:return t=i.sent(),log("VLM Connected!",t),t&&(this.sceneRoom=t,this.connected=!0,this.connecting=!1),[2,t];case 2:throw n=i.sent(),T.addMessage("Virtual Land Manager could not load the scene...please try to refresh. An error has been logged."),n;case 3:return[2]}}))}))},e.reconnect=function(){try{o.connected=!1,o.connecting=!0;var t=o.sceneRoom.sessionId||e.sessionData.sessionId||"";o.client.reconnect(o.sceneRoom.id,t)}catch(e){throw e}},e.getPlatformData=function(){return h(void 0,void 0,void 0,(function(){var e,n,r,a,c,l,h,v,m,y,I,E,w;return f(o,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Promise.all([i.getUserData(),s.getParcel(),t.getPlatform(),t.getCurrentRealm()])];case 1:return e=p.apply(void 0,[o.sent(),4]),n=e[0],r=e[1],a=e[2],c=e[3],l=r.land.sceneJsonData,h=l.scene.base,v=l.scene.parcels,m=null===(E=null==l?void 0:l.vlm)||void 0===E?void 0:E.sceneId,y=n?function(e){return e.avatar,d(e,["avatar"])}(n):{},(I=this.platformData).world="decentraland",I.subPlatform=a,I.sceneJsonData=l,I.baseParcel=h,I.sceneId=m,I.user=y,I.location={world:"decentraland",location:null===(w=null==l?void 0:l.display)||void 0===w?void 0:w.title,coordinates:h.split(","),parcels:v,realm:c},I.environment=g.devMode?"dev":"prod",this.dclUserData=n,[2,u(u({},this.platformData),I)];case 2:throw o.sent();case 3:return[2]}}))}))},e}();!function(){function e(e){this.action=e.action,this.element=e.element,this.data=e.data}e=l([EventConstructor()],e)}();var A=function(){function e(e){this.id=e.id,this.type=e.type,this.data=e.data,this.sessionToken=b.sessionData.sessionToken}return e=l([EventConstructor()],e)}(),S=function(){function e(e){this.configs=e}return e=l([EventConstructor()],e)}(),C=function(){function e(e){this.action=e.action,this.pathId=e.pathId,this.pathSegments=e.pathSegments,this.sessionToken=b.sessionData.sessionToken}return e=l([EventConstructor()],e)}(),O=function(){function e(e){this.added=0,this.action=e.action,this.pathId=e.pathId,this.added=e.added||0,this.total=e.total}return e=l([EventConstructor()],e)}();!function(){function e(e){this.session=e.session}e=l([EventConstructor()],e)}();var k,P,N=function(){function e(e){this.action="scene_sound_locators",this.elementData=e.elementData,this.instanceData=e.instanceData,this.showLocators=e.showLocators,this.userId=e.userId}return e=l([EventConstructor()],e)}(),_=function(){function e(e,t){this.action=e,this.metadata=t,this.sessionToken=b.sessionData.sessionToken}return e=l([EventConstructor()],e)}(),L=function(){function e(e,t){this.witnessed=!0,this.action=e,this.metadata=t}return e=l([EventConstructor()],e)}(),D=function(){function e(e){this.action=e.action,this.claimAction=e.claimAction,this.messageOptions=e.messageOptions,this.sessionToken=b.sessionData.sessionToken}return e=l([EventConstructor()],e)}(),x=function(){function e(e){this.action="scene_video_status",this.sceneId=e.sceneId,this.status=e.status,this.url=e.url,this.sk=e.sk}return e=l([EventConstructor()],e)}(),R=function(){function e(e){this.action=null==e?void 0:e.action,this.property=null==e?void 0:e.property,this.id=null==e?void 0:e.id,this.element=null==e?void 0:e.element,this.instance=null==e?void 0:e.instance,this.setting=null==e?void 0:e.setting,this.elementData=null==e?void 0:e.elementData,this.instanceData=null==e?void 0:e.instanceData,this.settingsData=null==e?void 0:e.settingsData,this.scenePreset=null==e?void 0:e.scenePreset,this.user=null==e?void 0:e.user}return e=l([EventConstructor()],e)}(),M=function(){function e(){}return e=l([EventConstructor()],e)}(),$=function(){function e(){}return e.events=new EventManager,e}();!function(e){var t;!function(e){e[e.NONE=0]="NONE",e[e.EXTERNAL=1]="EXTERNAL",e[e.TRACKING_ONLY=2]="TRACKING_ONLY",e[e.SOUND=3]="SOUND",e[e.STREAM=4]="STREAM",e[e.MOVE=5]="MOVE",e[e.TELEPORT=6]="TELEPORT"}(t=e.Actions||(e.Actions={}));var n=function(e,n){var i=this;this.trackClickEvent=function(e,t){var n=e.trackingId||t;e.hasTracking&&b.events.fireEvent(new _(n))};try{this.type=e.type||t.NONE,this.showFeedback=e.showFeedback,this.hoverText=e.hoverText,this.externalLink=e.externalLink,this.sound=e.sound,this.moveTo=e.moveTo,this.teleportTo=e.teleportTo,this.hasTracking=e.hasTracking,this.trackingId=e.trackingId,this.synced=e.synced;var s=e,r=n.customId,a=this.showFeedback,c=this.hoverText;if(!s||!n)return;switch(s.type){case t.NONE:return void(n.getComponentOrNull(OnPointerDown)&&n.removeComponent(OnPointerDown));case t.TRACKING_ONLY:this.pointerDownEvent=new OnPointerDown((function(){i.trackClickEvent(s,"click-event ".concat(r))}),{showFeedback:a,hoverText:c});break;case t.EXTERNAL:this.pointerDownEvent=new OnPointerDown((function(){s.externalLink&&(openExternalURL(s.externalLink),i.trackClickEvent(s,"click-event-(external-link) ".concat(r)))}),{showFeedback:a,hoverText:c});break;case t.SOUND:this.pointerDownEvent=new OnPointerDown((function(){i.trackClickEvent(s,"click-event-(sound)  ".concat(r))}),{showFeedback:a,hoverText:c});break;case t.MOVE:this.pointerDownEvent=new OnPointerDown((function(){s.moveTo&&(o.movePlayerTo(s.moveTo.position,s.moveTo.setCameraTarget?s.moveTo.cameraTarget:void 0),i.trackClickEvent(s,"click-event-(move-player) ".concat(r)))}),{showFeedback:a,hoverText:c});break;case t.TELEPORT:this.pointerDownEvent=new OnPointerDown((function(){s.teleportTo&&(teleportTo(s.teleportTo),i.trackClickEvent(s,"click-event-(teleport-player)  ".concat(r)))}),{showFeedback:a,hoverText:c})}}catch(e){throw e}};e.DCLConfig=n}(k||(k={})),function(e){e[e.NORTH=0]="NORTH",e[e.EAST=1]="EAST",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST"}(P||(P={})),P.NORTH,P.NORTH;var V=16;P.SOUTH,P.SOUTH;var U,G,B=function(e,t){void 0===e&&(e=[]);for(var n=0;n<e.length;n++)if(JSON.stringify(e[n])===JSON.stringify(t))return!0},W=function(e){return Object.keys(engine.entities).map((function(e){return engine.entities[e]})).filter((function(t){return t.name===e}))[0]};!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.sk=t.sk,n.customId=t.customId,n.parent=t.parent,n.enabled=t.enabled||!0,n}return c(t,e),t}(Material);e.MaterialConfig=t;var n=function(e){function t(t){var n=this,i="ethereum://".concat(t.contractAddress,"/").concat(t.tokenId);return(n=e.call(this,i)||this).sk=t.sk,n.customId=t.customId,n.name=t.name,n.parent=t.parent,n.enabled=t.enabled||!0,n}return c(t,e),t}(NFTShape);e.NFTConfig=n;var i=function(e){function t(t){var n=e.call(this,new AudioClip(""))||this;return n.sk=t.sk,n.customId=t.customId,n.parent=t.parent,n.name=t.name,n.enabled=t.enabled||!0,n}return c(t,e),t}(AudioSource);e.AudioConfig=i;var s=function(e){function t(t,n){var i=this,s=n.sk;return(i=e.call(this,(null==n?void 0:n.customId)||(null==n?void 0:n.name))||this).updateParent=function(e){if(e){i.parent=e;var t=W(e);i.setParent(t)}else i.setParent(null)},i.sk=s,i.name=n.name,i.enabled=t.enabled||n.enabled,i.customId=n.customId,i.customRendering=n.customRendering,i.configId=(null==n?void 0:n.configId)||t.sk,i.parent=n.parent,i.position=n.position,i.rotation=n.rotation,i.scale=n.scale,i}return c(t,e),t}(Entity);e.Instance=s}(U||(U={})),function(e){e.configs={},e.instances={};var t=function(t){function n(n){var s=t.call(this)||this;return s.albedoTexture=new Texture(""),s.alphaTexture=new Texture(""),s.emissiveColor=Color3.White(),s.emissiveTexture=new Texture(""),s.instanceIds=[],s.roughness=1,s.specularIntensity=0,s.metallic=0,s.init=function(t){try{if(s.sk=t.sk,s.customId=t.customId,s.customRendering=!!t.customRendering,s.parent=t.parent,s.enabled=t.enabled,s.emissiveIntensity=t.emission||1,s.imageSrc=t.textureSrc||t.imageSrc,s.withCollisions=t.withCollisions,s.isTransparent=t.isTransparent,s.clickEvent=t.clickEvent,e.configs[s.sk]=s,s.updateTexture(t),s.customId&&(e.configs[s.customId]=e.configs[s.sk]),s.customRendering||!t.instances||t.instances.length<1)return;t.instances.forEach((function(e){s.createInstance(e)}))}catch(e){throw e}},s.showAll=function(){try{s.instanceIds.forEach((function(t){var n=e.instances[t].enabled,i=e.instances[t].parent||s.parent;n&&(i?e.instances[t].updateParent(i):e.instances[t].customRendering||e.instances[t].add())}))}catch(e){throw e}},s.remove=function(){try{s.instanceIds.forEach((function(t){e.instances[t].remove()}))}catch(e){throw e}},s.delete=function(){try{delete e.configs[s.sk],s.instanceIds.forEach((function(t){e.instances[t].delete()}))}catch(e){throw e}},s.updateParent=function(t){try{s.instanceIds.forEach((function(n){e.instances[n].parent===s.parent&&e.instances[n].updateParent(t)})),s.parent=t}catch(e){throw e}},s.updateCustomId=function(t){try{s.customId&&e.configs[s.customId]&&delete e.configs[s.customId],e.configs[t]=e.configs[s.sk],s.customId=t}catch(e){throw e}},s.updateCustomRendering=function(e){try{s.customRendering=e,e?s.remove():s.showAll()}catch(e){throw e}},s.updateTexture=function(e){try{e&&(s.imageSrc=e.textureSrc||e.imageSrc);var t=new Texture(s.imageSrc,{hasAlpha:s.isTransparent});s.albedoTexture=t,s.emissiveTexture=t,s.alphaTexture=t,s.isTransparent?s.transparencyMode=TransparencyMode.ALPHA_TEST:s.transparencyMode=TransparencyMode.OPAQUE}catch(e){throw e}},s.updateBrightness=function(e){s.emissiveIntensity=e},s.updateTransparency=function(e){try{s.isTransparent=e,s.updateTexture()}catch(e){throw e}},s.updateClickEvent=function(t){try{s.clickEvent=t,s.instanceIds.forEach((function(t){e.instances[t].updateDefaultClickEvent(s.clickEvent)}))}catch(e){throw e}},s.createInstance=function(t){B(s.instanceIds,t.sk)||s.instanceIds.push(t.sk),new i(s,t),t.customId&&(e.instances[t.customId]=e.instances[t.sk])},s.deleteInstance=function(t){try{log("VLM - DELETING INSTANCE - Step 4",t),s.instanceIds=s.instanceIds.filter((function(e){return e!==t})),e.instances[t].delete()}catch(e){throw e}},s.removeInstance=function(t){e.instances[t].remove()},s.addInstance=function(t){e.instances[t].add()},s.init(n),s}return c(n,t),n}(Material);e.DCLConfig=t;var n=function(e){function t(t){var n=e.call(this,t)||this;return n.textureSrc=t.textureSrc,n.emission=t.emission,n.instances=t.instances,n}return c(t,e),t}(t);e.VLMConfig=n;var i=function(t){function n(n,i){var s=t.call(this,n,i)||this;return s.correctUvs=true,s.init=function(t,n){try{s.sk=n.sk,s.customId=n.customId,s.parent=n.parent||t.parent,s.customRendering=n.customRendering,s.configId=t.sk,s.position=n.position,s.scale=n.scale,s.rotation=n.rotation,s.enabled=n.enabled,s.clickEvent=n.clickEvent,s.defaultClickEvent=t.clickEvent,s.withCollisions=n.withCollisions,e.instances[s.sk]=s,log("VLM - CREATING INSTANCE - Step 3",e.instances&&e.instances[s.sk]);var i=new PlaneShape;s.correctUvs&&(i.uvs=[0,0,1,0,1,1,0,1,1,0,0,0,0,1,1,1]),void 0===s.withCollisions&&(s.withCollisions=t.withCollisions),i.withCollisions=s.withCollisions,s.addComponentOrReplace(i),s.addComponentOrReplace(t),s.updateTransform(s.position,s.scale,s.rotation),s.updateDefaultClickEvent(t.clickEvent),s.parent&&s.enabled&&!s.customRendering?s.updateParent(s.parent):s.enabled&&s.add(),s.customId&&(e.instances[s.customId]=e.instances[s.sk])}catch(e){throw e}},s.add=function(){try{if(s.isAddedToEngine())return;s.parent?s.updateParent(s.parent):engine.addEntity(s)}catch(e){throw e}},s.delete=function(){try{s.remove(),delete e.instances[s.sk],s.customId&&delete e.instances[s.customId]}catch(e){throw e}},s.remove=function(){try{s.isAddedToEngine()&&engine.removeEntity(s)}catch(e){throw e}},s.updateParent=function(e){try{if(e){s.parent=e;var t=W(e);s.setParent(t)}else s.setParent(null)}catch(e){throw e}},s.updateCustomId=function(t){try{s.customId&&e.instances[s.customId]&&delete e.instances[s.customId],s.customId=t,s.init(e.configs[s.configId],s)}catch(e){throw e}},s.updateCustomRendering=function(e){try{s.customRendering=e,e?s.remove():s.add()}catch(e){throw e}},s.updateTransform=function(e,t,n){try{s.addComponentOrReplace(new Transform({position:new Vector3(e.x,e.y,e.z),scale:new Vector3(t.x,t.y,t.z),rotation:Quaternion.Euler(n.x,n.y,n.z)}))}catch(e){throw e}},s.updateCollider=function(t){try{s.withCollisions=t.withCollisions,s.init(e.configs[s.configId],s)}catch(e){throw e}},s.updateDefaultClickEvent=function(e){try{s.defaultClickEvent=e,s.updateClickEvent()}catch(e){throw e}},s.updateClickEvent=function(t){var n;try{void 0!==t&&(s.clickEvent=t),s.clickEvent&&(null===(n=s.clickEvent)||void 0===n?void 0:n.synced)&&(s.clickEvent=s.defaultClickEvent);var i=s.clickEvent,o=e.instances[s.sk];if(!i||!o)return;var r=new k.DCLConfig(i,o);r.pointerDownEvent?e.instances[s.sk].addComponentOrReplace(r.pointerDownEvent):e.instances[s.sk].getComponentOrNull(OnPointerDown)&&e.instances[s.sk].removeComponent(OnPointerDown)}catch(e){throw e}},s.init(n,i),s}return c(n,t),n=l([Component("VLMImageInstance")],n)}(U.Instance);e.DCLInstanceConfig=i;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(i);e.VLMInstanceConfig=s}(G||(G={}));var F,H=function(){function e(){}var t;return t=e,e.init=function(e){try{if(!e)return;e.forEach((function(e){t.create(e)}))}catch(e){throw e}},e.create=function(e){try{if(!e.enabled)return;new G.DCLConfig(e)}catch(e){throw e}},e.createInstance=function(e,t){try{if(!e.enabled||!t.enabled)return;var n=e.sk;G.configs[n].createInstance(t)}catch(e){throw e}},e.update=function(e,n,i){try{var s=G.configs[e.sk||i];if(!e||!s&&!e.enabled)return;switch(!s&&e.enabled&&new G.DCLConfig(e),n){case"enabled":e.enabled?s&&t.add(e.sk):t.remove(e.sk);break;case"imageSrc":s.updateTexture(e);break;case"emission":s.emissiveIntensity=e.emission;break;case"clickEvent":s.updateClickEvent(e.clickEvent);break;case"isTransparent":s.updateTransparency(e.isTransparent);break;case"parent":s.updateParent(e.parent);break;case"customId":s.updateCustomId(e.customId)}}catch(e){throw e}},e.updateInstance=function(e,t,n){try{var i=G.instances[e.sk],s=i.configId,o=G.configs[s];if(!o)return;!i&&e.enabled&&o.createInstance(e);var r=e.position,a=e.scale,c=e.rotation;switch(t){case"enabled":o.enabled&&e.enabled?i&&e.enabled&&o.addInstance(e.sk):o.removeInstance(e.sk);break;case"transform":i.updateTransform(r,a,c);break;case"clickEvent":i.updateClickEvent(e.clickEvent);break;case"properties":i.updateParent(e.parent),i.updateCustomId(e.customId),i.updateCustomRendering(e.customRendering),i.updateCollider(e);break;case"withCollider":i.updateCollider(e);break;case"customId":i.updateCustomId(e.customId);break;case"customRendering":i.updateCustomRendering(e.customRendering);break;case"parent":i.updateParent(e.parent)}}catch(e){throw e}},e.add=function(e){G.configs[e].showAll()},e.delete=function(e){G.configs[e].delete()},e.remove=function(e){G.configs[e].remove()},e.removeInstance=function(e){G.instances[e].remove()},e.deleteInstance=function(e){log("VLM - Deleting Instance - Step 1",e);var t=Object.keys(G.instances).map((function(e){return e})),n=Object.keys(G.instances).map((function(e){return G.instances[e].name}));log(t),log(n);var i=G.instances[e],s=null==i?void 0:i.configId;log("VLM - Deleting Instance - Step 2",i,e),s&&(log("VLM - Deleting Instance - Step 3",e,s),G.configs[s].deleteInstance(e))},e}();!function(e){var t,n;e.configs={},e.instances={},e.systems={},function(e){e[e.NONE=0]="NONE",e[e.IMAGE=1]="IMAGE",e[e.PLAYLIST=2]="PLAYLIST",e[e.LIVE=3]="LIVE"}(t=e.SourceTypes||(e.SourceTypes={})),(n=e.StreamState||(e.StreamState={}))[n.NOT_FOUND=0]="NOT_FOUND",n[n.INACTIVE=1]="INACTIVE",n[n.STATIC=2]="STATIC",n[n.LIVE=3]="LIVE";var i=function(n){function i(i){var s=n.call(this,i)||this;return s.instanceIds=[],s.roughness=1,s.specularIntensity=0,s.metallic=0,s.emissiveColor=Color3.White(),s.liveSrc="",s.playlist=[],s.isLive=!1,s.offImageSrc="",s.uvsFlipped=!1,s.init=function(n){var i;try{if(s.sk=n.sk,s.customId=n.customId,s.parent=n.parent,s.enabled=null==n?void 0:n.enabled,s.enableLiveStream=null==n?void 0:n.enableLiveStream,s.isLive=n.isLive,s.liveSrc=n.liveSrc,s.offType=n.offType,s.offImageSrc=n.offImageSrc,s.customRendering=!!n.customRendering,s.emissiveIntensity=n.emissiveIntensity||1,s.clickEvent=n.clickEvent,s.volume=n.volume||1,s.playlist=n.playlist||s.playlist,s.withCollisions=n.withCollisions,s.textureMode=s.isLive&&s.enableLiveStream?t.LIVE:s.offType,s.updateTexture(),s.updateClickEvent(n.clickEvent),e.configs[s.sk]=s,s.customId&&(e.configs[s.customId]=e.configs[s.sk]),s.customRendering)return;null===(i=n.instances)||void 0===i||i.forEach((function(e){s.createInstance(e)})),e.systems[s.sk]?(delete e.systems[s.sk],new a(s)):new a(s)}catch(e){throw e}},s.remove=function(){var t;null===(t=s.instanceIds)||void 0===t||t.forEach((function(t){try{e.instances[t].remove()}catch(e){throw e}}))},s.delete=function(){var t;engine.removeSystem(e.systems[s.sk]),delete e.systems[s.sk],delete e.configs[s.sk],null===(t=s.instanceIds)||void 0===t||t.forEach((function(t){e.instances[t].delete()}))},s.showAll=function(){var t;null===(t=s.instanceIds)||void 0===t||t.forEach((function(t){var n=e.instances[t].enabled,i=e.instances[t].parent||s.parent;n&&(i?e.instances[t].updateParent(i):e.instances[t].add())}))},s.createInstance=function(t){B(s.instanceIds,t.sk)||s.instanceIds.push(t.sk),new o(s,t),t.customId&&(e.instances[t.customId]=e.instances[t.sk])},s.removeInstance=function(t){e.instances[t].remove()},s.deleteInstance=function(t){s.instanceIds=s.instanceIds.filter((function(e){return e!==t})),e.instances[t].delete()},s.addInstance=function(t){e.instances[t].add()},s.updateParent=function(t){var n;null===(n=s.instanceIds)||void 0===n||n.forEach((function(n){e.instances[n].parent===s.parent&&e.instances[n].updateParent(t)})),s.parent=t},s.updateCustomId=function(t){s.customId&&e.configs[s.customId]&&delete e.configs[s.customId],e.configs[t]=e.configs[s.sk],s.customId=t},s.updateCustomRendering=function(e){s.customRendering=e,e?s.remove():s.showAll()},s.updateOffType=function(t){s.offType=t,s.enabled&&!e.systems[s.sk]&&new a(s)},s.updateOnAirState=function(t){s.enableLiveStream=t,s.enableLiveStream&&s.enabled&&!e.systems[s.sk]&&new a(s)},s.updateOffImage=function(e){s.offImageSrc=e,s.updateTexture(s.offImageSrc),s.showAll()},s.updateTexture=function(n){var i,o,r;if(null===(i=s.instanceIds)||void 0===i||i.forEach((function(t){(e.instances[t].getComponentOrNull(Material)||e.instances[t].getComponentOrNull(BasicMaterial))&&e.instances[t].removeComponent(Material)})),s.textureMode===t.IMAGE){var a=n||s.offImageSrc;r=new Texture(a,{hasAlpha:!0}),s.videoTexture=null,s.imageTexture=r,s.albedoTexture=r,s.emissiveTexture=r,s.stop()}else if(s.textureMode===t.LIVE){a=n||s.liveSrc;var c=new VideoClip(a);r=new VideoTexture(c),s.imageTexture=null,s.videoTexture=r,s.albedoTexture=r,s.emissiveTexture=r,s.stop()}else if(s.textureMode===t.PLAYLIST){var u=e.systems[s.sk];if(B(s.playlist,null==u?void 0:u.playlist[u.playlistIndex]))return;a=n||s.playlist[0],c=new VideoClip(a);r=new VideoTexture(c),s.imageTexture=null,s.videoTexture=r,s.albedoTexture=r,s.emissiveTexture=r}null===(o=s.instanceIds)||void 0===o||o.forEach((function(t){e.instances[t].addComponentOrReplace(s)})),s.correctUvs()},s.correctUvs=function(){var n;s.uvsFlipped=s.textureMode===t.IMAGE,null===(n=s.instanceIds)||void 0===n||n.forEach((function(t){e.instances[t].correctUvs(s.uvsFlipped)}))},s.updateVolume=function(e){s.volume=e;var t=s.videoTexture.position;s.videoTexture.volume=e,s.videoTexture.seekTime(t)},s.updatePlaylist=function(e){try{s.playlist=e.playlist,log("go fuck yourself bitch")}catch(e){throw e}},s.updateClickEvent=function(t){var n;s.clickEvent=t,null===(n=s.instanceIds)||void 0===n||n.forEach((function(t){e.instances[t].updateDefaultClickEvent(s.clickEvent)}))},s.start=function(){s.textureMode==t.LIVE?s.startLive():s.textureMode==t.PLAYLIST&&s.startPlaylist()},s.startLive=function(){try{s.textureMode=t.LIVE,s.stop(),s.updateTexture(s.liveSrc),s.videoTexture&&s.videoTexture.play(),s.showAll()}catch(e){throw e}},s.startPlaylist=function(){s.textureMode=t.PLAYLIST;var n=e.systems[s.sk]||new a(s);if(s.updateTexture(s.playlist[n.playlistIndex]),!s.videoTexture)return s.updateTexture(s.playlist[0]);s.videoTexture.play(),s.showAll()},s.showImage=function(){return h(s,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:this.textureMode=t.IMAGE,this.stop(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,fetch(this.offImageSrc)];case 2:return e.sent(),[3,4];case 3:return e.sent(),log("VLM - Placeholder image not found"),[2];case 4:return this.updateTexture(this.offImageSrc),this.showAll(),[2]}}))}))},s.setLiveState=function(n){try{if(s.isLive=n,!s.enabled)return;s.isLive||s.textureMode!==t.LIVE?s.isLive&&s.enabled&&s.startLive():(s.stop(),s.textureMode=s.offType),s.textureMode===t.NONE?s.remove():s.textureMode!==t.IMAGE&&s.start(),s.enabled&&e.systems[s.sk]&&!s.isLive&&s.offType===t.PLAYLIST?(e.systems[s.sk].reset(),e.systems[s.sk].start()):!s.isLive&&e.systems[s.sk]?e.systems[s.sk].kill():e.systems[s.sk]&&s.isLive&&(delete e.systems[s.sk],new a(s))}catch(e){throw e}},s.playNextVideo=function(){try{var t=e.systems[s.sk]||new a(s);if(t.playlistIndex+=1,t.playlistIndex>s.playlist.length-1&&(t.playlistIndex=0),!s.playlist[t.playlistIndex])return log("VLM - No video found in playlist"),s.playNextVideo();s.updateTexture(s.playlist[t.playlistIndex]),s.videoTexture&&(s.stop(),s.videoTexture.play())}catch(e){throw e}},s.stop=function(){try{s.videoTexture&&(s.videoTexture.pause(),s.videoTexture.reset())}catch(e){throw e}},s.init(i),s}return c(i,n),i}(U.MaterialConfig);e.DCLConfig=i;var s=function(e){function t(t){var n=e.call(this,t)||this;return n.instances=t.instances,n.emission=t.emission,n}return c(t,e),t}(i);e.VLMConfig=s;var o=function(n){function i(i,s){var o=n.call(this,i,s)||this;return o.flipUvs=true,o.uvsFlipped=!1,o.add=function(){var n=o.parent||e.configs[o.configId].parent,i=!e.configs[o.configId].enabled||e.configs[o.configId].textureMode===t.NONE;n?o.updateParent(n):o.isAddedToEngine()||i||engine.addEntity(o)},o.delete=function(){try{o.remove(),delete e.instances[o.sk],o.customId&&delete e.instances[o.customId]}catch(e){throw e}},o.remove=function(){try{o.isAddedToEngine()&&engine.removeEntity(o)}catch(e){throw e}},o.correctUvs=function(e){try{var t=o.getComponentOrNull(PlaneShape);if(!t)return;t.uvs=e?[0,0,1,0,1,1,0,1,1,0,0,0,0,1,1,1]:[0,1,1,1,1,0,0,0,1,1,0,1,0,0,1,0]}catch(e){throw e}},o.updateParent=function(e){try{if(e){o.parent=e;var t=W(e);o.setParent(t)}else o.setParent(null)}catch(e){throw e}},o.updateCustomId=function(t){try{o.customId&&e.instances[o.customId]&&delete e.instances[o.customId],e.instances[t]=e.instances[o.sk],o.customId=t}catch(e){throw e}},o.updateCustomRendering=function(e){try{o.customRendering=e,e?o.remove():o.add()}catch(e){throw e}},o.updateTransform=function(e,t,n){try{var i={position:e||o.position,scale:t||o.scale,rotation:n||o.rotation},s=i.position,r=i.scale,a=i.rotation;o.addComponentOrReplace(new Transform({position:new Vector3(s.x,s.y,s.z),scale:new Vector3(r.x,r.y,r.z),rotation:Quaternion.Euler(a.x,a.y,a.z)}))}catch(e){throw e}},o.updateCollider=function(t){try{o.withCollisions=t,o.init(e.configs[o.configId],o)}catch(e){throw e}},o.updateDefaultClickEvent=function(e){try{o.defaultClickEvent=e,o.updateClickEvent()}catch(e){throw e}},o.updateClickEvent=function(t){var n;try{void 0!==t&&(o.clickEvent=t),o.clickEvent&&(null===(n=o.clickEvent)||void 0===n?void 0:n.synced)&&(o.clickEvent=o.defaultClickEvent);var i=o.clickEvent,s=e.instances[o.sk];if(!i||!s)return;var r=new k.DCLConfig(i,s);r.pointerDownEvent?e.instances[o.sk].addComponentOrReplace(r.pointerDownEvent):e.instances[o.sk].getComponentOrNull(OnPointerDown)&&e.instances[o.sk].removeComponent(OnPointerDown)}catch(e){throw e}},o.textureModeIs=function(t){return e.configs[o.configId].textureMode==t},o.init(i,s),o}return c(i,n),i.prototype.init=function(n,i){this.sk=i.sk,this.parent=i.parent||n.parent,this.enabled=!!n.enabled&&i.enabled,this.position=i.position,this.scale=i.scale,this.rotation=i.rotation,this.withCollisions=i.withCollisions,this.configId=n.sk,this.uvsFlipped=n.uvsFlipped||this.uvsFlipped,this.clickEvent=i.clickEvent,this.defaultClickEvent=n.clickEvent,e.instances[this.sk]=this;var s=new PlaneShape;s.withCollisions=this.withCollisions,this.addComponent(s),this.addComponent(n),this.updateTransform(this.position,this.scale,this.rotation),this.updateDefaultClickEvent(n.clickEvent),this.correctUvs(n.textureMode===t.IMAGE),this.enabled&&this.add()},i}(U.Instance);e.DCLInstanceConfig=o;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(o);e.VLMInstanceConfig=r;var a=function(){function n(n){var i,s=this;this.enableDebugging=g.devMode&&!0,this.timer=0,this.dtDelay=0,this.playlistObservers=[],this.playlistData=[],this.videoLength=0,this.videoStatus=0,this.videoProgress=0,this.checkingStatus=!0,this.isLive=!1,this.enableLiveStream=!1,this.playing=!1,this.playlist=[],this.playlistIndex=0,this.instancesHidden=!1,this.stopped=!1,this.initialized=!1,this.start=function(){s.stopped=!1,s.dbLog("VLM VIDEO SYSTEM - STATE CHANGE - STARTED SYSTEM")},this.stop=function(){s.stopped=!0,s.dbLog("VLM VIDEO SYSTEM - STATE CHANGE - STOPPED SYSTEM")},this.kill=function(){s.stopped=!0,engine.removeSystem(s),s.dbLog("VLM VIDEO SYSTEM - STATE CHANGE - TERMINATED SYSTEM")},this.reset=function(){s.removeVideoObserver(),s.video.showAll(),s.dbLog("VLM VIDEO SYSTEM - STATE CHANGE - START EMPTY STATE")},this.emptyLoop=function(){s.video.textureMode===t.NONE&&s.initialized?s.dbLog("VLM VIDEO SYSTEM - IDLE STATE - INVISIBLE MODE"):(s.video.textureMode=t.NONE,s.video.remove(),s.playing=!1,s.initialized=!0,s.dbLog("VLM VIDEO SYSTEM - STATE CHANGE - START EMPTY STATE"))},this.liveStreamLoop=function(){log("VLM - Live Stream Loop"),s.video.textureMode===t.LIVE&&s.initialized?s.dbLog("VLM VIDEO SYSTEM - IDLE STATE - LIVE STREAM MODE - ".concat(s.video.liveSrc)):(s.removeVideoObserver(),s.video.startLive(),s.playing=!0,s.initialized=!0,s.dbLog("VLM VIDEO SYSTEM - STATE CHANGE - START LIVE STREAM"))},this.playlistLoop=function(e){try{s.playlist[s.playlistIndex]&&!s.playlistData[s.playlistIndex]?(s.playlistData[s.playlistIndex]={videoClipId:null,componentId:null,totalVideoLength:null,videoStatus:null,currentOffset:null,observer:null},s.dbLog("VLM VIDEO SYSTEM - PLAYLIST MODE - INITIALIZED PLAYLIST DATA")):s.playlist[s.playlistIndex],s.dbLog("VLM VIDEO SYSTEM - PLAYLIST MODE - PLAYING VIDEO ".concat(s.playlistIndex," - ").concat(s.playlist[s.playlistIndex])),s.playlistData[s.playlistIndex].observer||(s.playlistData[s.playlistIndex].observer=onVideoEvent.add((function(t){if(!t.videoClipId||t.videoClipId===s.video.videoTexture.videoClipId){var n=t.currentOffset/t.totalVideoLength*100,i=Math.round(100*n)/100;if(0===s.videoProgress&&i>0)s.videoProgress=i;else if(s.videoProgress<i)s.videoProgress=i;else if(i>99)s.videoProgress=i;else if(!(s.videoProgress>i))return;var o=s.playlistIndex,r={videoClipId:t.videoClipId,componentId:t.componentId,totalVideoLength:Math.floor(t.totalVideoLength),videoStatus:t.videoStatus,currentOffset:Math.ceil(t.currentOffset)};return s.playlistData[o]=u(u({},s.playlistData[o]),r),r.totalVideoLength>0&&r.currentOffset>=r.totalVideoLength-e?(s.videoProgress=0,s.removeVideoObserver(),void s.video.playNextVideo()):void 0}s.removeVideoObserver()}))),s.video.textureMode===t.PLAYLIST&&s.initialized||(s.playing=!0,s.video.startPlaylist(),s.initialized=!0)}catch(e){throw e}},this.imageLoop=function(){var n=e.configs[s.sk];return n.textureMode===t.IMAGE&&s.video.imageTexture&&s.initialized?void s.dbLog("VLM VIDEO SYSTEM - IDLE STATE - IMAGE MODE"):(n.remove(),n.showImage(),s.playing=!1,s.initialized=!0,n.showAll(),void s.dbLog("VLM VIDEO SYSTEM - STATE CHANGED - SHOW IMAGE"))},this.removeVideoObserver=function(){s.playlistData[s.playlistIndex]&&s.playlistData[s.playlistIndex].observer&&(onVideoEvent.remove(s.playlistData[s.playlistIndex].observer),s.playlistData[s.playlistIndex]={videoClipId:null,componentId:null,totalVideoLength:null,videoStatus:null,currentOffset:null,observer:null})},this.dbLog=function(e){s.enableDebugging&&log(e)},this.video=e.configs[n.sk],this.sk=n.sk,this.isLive=n.isLive,this.offType=n.offType,this.textureMode=n.textureMode,this.enableLiveStream=n.enableLiveStream,this.playlist=null==n?void 0:n.playlist,e.systems[n.sk]=this,n.customId&&(this.customId=n.customId,e.systems[this.customId]=this),engine.addSystem(e.systems[n.sk]),(null===(i=this.video)||void 0===i?void 0:i.customRendering)&&this.stop()}return n.prototype.update=function(n){var i,s;if(!this.stopped)if(!this.video||this.dtDelay>1)this.dtDelay=0;else if(this.dtDelay>0)this.dtDelay+=n;else{if(0===this.dtDelay&&(this.dtDelay+=n),(this.enableLiveStream!==this.video.enableLiveStream||this.offType!==this.video.offType||this.textureMode!==this.video.textureMode||this.isLive!==this.video.isLive||this.playlist!==this.video.playlist||this.playing!==!!(null===(i=this.video.videoTexture)||void 0===i?void 0:i.playing))&&(this.dbLog("VLM VIDEO SYSTEM - STATE CHANGE - CHANGED STATE"),this.enableLiveStream=this.video.enableLiveStream,this.offType=this.video.offType,this.textureMode=this.video.textureMode,this.isLive=this.video.isLive,this.playlist=this.video.playlist,this.playing=!!(null===(s=this.video.videoTexture)||void 0===s?void 0:s.playing)),!e.configs[this.sk].enabled)return this.removeVideoObserver(),void this.kill();this.enableLiveStream&&this.isLive?this.liveStreamLoop():this.video.offType!==t.PLAYLIST?this.video.offType!==t.IMAGE?this.video.offType===t.NONE&&this.emptyLoop():this.imageLoop():this.playlistLoop(n)}},n}();e.VLMVideoSystem=a}(F||(F={}));var j,z=function(){function e(){}var t;return t=e,e.init=function(e){try{if(!e)return;e.forEach((function(e){var n=F.configs[e.sk];n&&n.delete(),t.create(e)}))}catch(e){throw e}},e.create=function(e){try{if(!e.enabled)return;new F.DCLConfig(e)}catch(e){throw e}},e.createInstance=function(e,t){try{if(!e.enabled||!t.enabled)return;var n=e.sk;F.configs[n].createInstance(t)}catch(e){throw e}},e.update=function(e,n,i){try{var s=F.configs[i||e.sk];if(!e||!s&&!e.enabled)return;switch(!s&&e.enabled&&new F.DCLConfig(e),n){case"enabled":e.enabled?s&&t.add(e.sk):t.remove(e.sk);break;case"liveSrc":s.liveSrc=e.liveSrc;break;case"enableLiveStream":s.updateOnAirState(e.enableLiveStream);break;case"playlist":s.updatePlaylist(e);break;case"volume":s.updateVolume(e.volume);break;case"emission":s.emissiveIntensity=e.emission||0;break;case"offType":s.updateOffType(e.offType);break;case"clickEvent":s.updateClickEvent(e.clickEvent);break;case"properties":s.updateParent(e.parent),s.updateCustomId(e.customId),s.updateCustomRendering(e.customRendering);case"offImageSrc":s.updateOffImage(e.offImageSrc);break;case"parent":s.updateParent(e.parent);break;case"customId":s.updateCustomId(e.customId);break;case"customRendering":s.updateCustomRendering(e.customRendering)}}catch(e){throw e}},e.updateInstance=function(e,t,n){try{var i=F.instances[null==e?void 0:e.sk]||F.instances[n],s=i.configId,o=F.configs[s];if(!o)return;!i&&e.enabled&&o.createInstance(e);var r=e.position,a=e.scale,c=e.rotation;switch(t){case"enabled":o.enabled&&e.enabled?i&&e.enabled&&o.addInstance(e.sk):o.removeInstance(e.sk);break;case"transform":i.updateTransform(r,a,c);break;case"properties":i.updateCollider(e),i.updateParent(e.parent),i.updateCustomId(e.customId),i.updateCustomRendering(e.customRendering);break;case"withCollider":i.updateCollider(e);break;case"clickEvent":i.updateClickEvent(e.clickEvent);break;case"customRendering":i.updateCustomRendering(e.customRendering);break;case"customId":i.updateCustomId(e.customId);break;case"parent":i.updateParent(e.parent)}}catch(e){throw e}},e.add=function(e){F.configs[e].showAll()},e.remove=function(e){F.configs[e].remove(),F.systems[e].kill()},e.delete=function(e){F.configs[e].delete()},e.removeInstance=function(e,t){var n=t||F.instances[e].configId;F.configs[n].removeInstance(e)},e.deleteInstance=function(e,t){var n=t||F.instances[e].configId;F.configs[n].deleteInstance(e)},e}();!function(e){e.configs={},e.instances={};var t=function(t){function n(n){var s=t.call(this,n)||this;return s.instanceIds=[],s.chain=1,s.updateNft=function(t){var n=s.getChainName(t.chain);s.chain=t.chain||s.chain,s.contractAddress=t.contractAddress,s.tokenId=t.tokenId||0,s.nftLink="".concat(n,"://").concat(t.contractAddress,"/").concat(t.tokenId),t.color&&(s.color=Color3.FromHexString(t.color)),s.style=t.style||PictureFrameStyle.Classic,v([],p(s.instanceIds),!1).forEach((function(t){var n=e.instances[t],i=new NFTShape(s.nftLink,{color:s.color,style:s.style});i.withCollisions=n.withCollisions,n.addComponentOrReplace(i)}))},s.getChainName=function(e){switch(Number(e)){case 1:default:return"ethereum";case 137:return"polygon"}},s.delete=function(){delete e.configs[s.sk],v([],p(s.instanceIds),!1).forEach((function(t){e.instances[t].delete()}))},s.remove=function(){v([],p(s.instanceIds),!1).forEach((function(t){e.instances[t].remove()}))},s.showAll=function(){v([],p(s.instanceIds),!1).forEach((function(t){var n=e.instances[t].enabled,i=e.instances[t].parent||s.parent;n&&(i?e.instances[t].updateParent(i):e.instances[t].add())}))},s.updateParent=function(t){v([],p(s.instanceIds),!1).forEach((function(n){e.instances[n].parent===s.parent&&e.instances[n].updateParent(t)})),s.parent=t},s.updateCustomId=function(t){s.customId&&e.configs[s.customId]&&delete e.configs[s.customId],e.configs[t]=e.configs[s.sk],s.customId=t},s.createInstance=function(t){s.instanceIds.push(t.sk),e.instances[t.sk]=new i(s,t),t.customId&&(e.instances[t.customId]=e.instances[t.sk]),e.instances[t.sk].add()},s.deleteInstance=function(t){s.instanceIds=s.instanceIds.filter((function(e){return e!==t})),e.instances[t].delete()},s.removeInstance=function(t){e.instances[t].remove()},s.addInstance=function(t){e.instances[t].add()},s.chain=s.getChainName(n.chain),s.nftLink="".concat(s.chain,"://").concat(n.contractAddress,"/").concat(n.tokenId),n.color&&(s.color=Color3.FromHexString(n.color)),s.style=n.style||PictureFrameStyle.Classic,s.sk=n.sk,s.customId=n.customId,s.contractAddress=n.contractAddress,s.withCollisions=n.withCollisions||!1,s.tokenId=n.tokenId||0,s.enabled=n.enabled||!0,e.configs[s.sk]=s,s.customId&&(e.configs[s.customId]=e.configs[s.sk]),n.instances&&n.instances.forEach((function(e){s.createInstance(e)})),s}return c(n,t),n}(U.MaterialConfig);e.DCLConfig=t;var n=function(e){function t(t){var n=e.call(this,t)||this;return n.instances=t.instances||[],n.color=t.color,n}return c(t,e),t}(t);e.VLMConfig=n;var i=function(t){function n(n,i){var s=this,o=n.color,r=n.style,a=new NFTShape(n.nftLink,{color:o,style:r});return(s=t.call(this,n,i)||this).add=function(){engine.addEntity(s)},s.delete=function(){delete e.instances[s.sk],s.customId&&delete e.instances[s.customId],engine.removeEntity(s)},s.remove=function(){try{s.isAddedToEngine()&&engine.removeEntity(s)}catch(e){throw e}},s.updateParent=function(e){if(e){s.parent=e;var t=W(e);s.setParent(t)}else s.setParent(null)},s.updateCustomId=function(t){s.customId&&e.instances[s.customId]&&delete e.instances[s.customId],e.instances[t]=e.instances[s.sk],s.customId=t},s.updateTransform=function(e,t,n){s.addComponentOrReplace(new Transform({position:new Vector3(e.x,e.y,e.z),scale:new Vector3(t.x,t.y,t.z),rotation:Quaternion.Euler(n.x,n.y,n.z)}))},s.updateCollider=function(t){s.withCollisions=t;var n=new NFTShape(s.config.nftLink,{color:s.config.color,style:s.config.style});n.withCollisions=s.withCollisions,e.configs[s.configId].withCollisions=s.withCollisions,s.addComponentOrReplace(n)},s.sk=i.sk,s.customId=i.customId,s.parent=i.parent,s.config=n,s.position=i.position,s.scale=i.scale,s.rotation=i.rotation,s.configId=n.sk,s.enabled=n.enabled||i.enabled,s.withCollisions="boolean"==typeof i.withCollisions?i.withCollisions:n.withCollisions,s.addComponent(a),s.updateTransform(s.position,s.scale,s.rotation),s.parent&&s.enabled?s.updateParent(s.parent):s.enabled&&s.add(),s}return c(n,t),n}(U.Instance);e.DCLInstanceConfig=i;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(i);e.VLMInstanceConfig=s}(j||(j={}));var K,Y=function(){function e(){}var t;return t=e,e.configs={},e.instances={},e.init=function(e){try{if(!e)return;e.forEach((function(e){t.create(e)}))}catch(e){throw e}},e.create=function(e){try{if(log("VLM: Creating NFT Frame"),!e.enabled)return;new j.DCLConfig(e)}catch(e){throw e}},e.createInstance=function(e,t){try{if(!(t&&e.enabled&&t.enabled&&e.sk))return;var n=e.sk;j.configs[n].createInstance(t)}catch(e){throw e}},e.update=function(e,n,i){try{var s=j.configs[e.sk];if(!e||!s&&!e.enabled)return;switch(!s&&e.enabled&&new j.DCLConfig(e),n){case"enabled":e.enabled?s&&t.add(e.sk):t.remove(e.sk);break;case"nftData":s.updateNft(e);break;case"parent":s.updateParent(e.parent);break;case"customId":s.updateCustomId(e.customId)}}catch(e){throw e}},e.updateInstance=function(e,t,n){try{var i=n||e.sk,s=j.instances[i],o=s.configId,r=j.configs[o];if(!r)return;!s&&e.enabled&&r.createInstance(e);var a=e.position,c=e.scale,u=e.rotation;switch(t){case"enabled":r.enabled&&e.enabled?s&&e.enabled&&r.addInstance(e.sk):r.removeInstance(e.sk);break;case"transform":s.updateTransform(a,c,u);break;case"collider":s.updateCollider(e.withCollisions);break;case"customId":s.updateCustomId(e.customId)}}catch(e){throw e}},e.add=function(e){j.configs[e].showAll()},e.delete=function(e){j.configs[e].delete()},e.remove=function(e){j.configs[e].remove()},e.removeInstance=function(e){var t=j.instances[e],n=null==t?void 0:t.configId;n&&j.configs[n].removeInstance(e)},e.deleteInstance=function(e){var t=j.instances[e],n=null==t?void 0:t.configId;n&&j.configs[n].deleteInstance(e)},e}();!function(e){var t;e.configs={},e.instances={},e.systems={},function(e){e[e.CLIP=0]="CLIP",e[e.LOOP=1]="LOOP",e[e.PLAYLIST=2]="PLAYLIST",e[e.STREAM=3]="STREAM"}(t=e.SourceType||(e.SourceType={}));var n=function(n){function i(i){var o=n.call(this,i)||this;o.instanceIds=[],o.audioClip=new AudioClip(""),o.showLocators=!1,o.remove=function(){try{o.instanceIds.forEach((function(t){e.instances[t].remove()}))}catch(e){throw e}},o.delete=function(){try{engine.removeSystem(e.systems[o.sk]),delete e.systems[o.sk],delete e.configs[o.sk],o.instanceIds.forEach((function(t){e.instances[t].delete()}))}catch(e){throw e}},o.showAll=function(){try{o.instanceIds.forEach((function(t){var n=e.instances[t].enabled,i=e.instances[t].parent||o.parent;n&&(i?e.instances[t].updateParent(i):e.instances[t].add())}))}catch(e){throw e}},o.createInstance=function(t){try{o.instanceIds.push(t.sk),e.instances[t.sk]=new s(o,t),t.customId&&(e.instances[t.customId]=e.instances[t.sk])}catch(e){throw e}},o.removeInstance=function(t){e.instances[t].remove()},o.deleteInstance=function(t){o.instanceIds=o.instanceIds.filter((function(e){return e!==t})),e.instances[t].delete()},o.addInstance=function(t){e.instances[t].add()},o.updateParent=function(t){try{o.instanceIds.forEach((function(n){e.instances[n].parent===o.parent&&e.instances[n].updateParent(t)})),o.parent=t}catch(e){throw e}},o.updateCustomId=function(t){try{o.customId&&e.configs[o.customId]&&delete e.configs[o.customId],e.configs[t]=e.configs[o.sk],o.customId=t}catch(e){throw e}},o.updateAllTransforms=function(t,n,i){try{o.instanceIds.forEach((function(s){e.instances[s].updateTransform(t,n,i)}))}catch(e){throw e}},o.updateVolume=function(e){try{o.volume=e,o.audioClip.volume=e}catch(e){throw e}},o.updateSource=function(n){try{var i=o;o.audioPath=n||o.audioPath,o.instanceIds.forEach((function(s){var o=e.instances[s];i.sourceType===t.STREAM&&e.instances[s].hasComponent(AudioSource)?e.instances[s].removeComponent(AudioSource):i.sourceType!==t.STREAM&&o.hasComponent(AudioStream)&&o.removeComponent(AudioStream),i.sourceType===t.STREAM?(i.audioStream=new AudioStream(n),e.instances[s].addComponentOrReplace(i.audioStream),i.audioStream.playing=i.enabled&&o.enabled):(i.audioClip=new AudioClip(n),o.addComponentOrReplace(new AudioSource(i.audioClip)),o.getComponent(AudioSource).playing=o.enabled,o.getComponent(AudioSource).loop=i.sourceType===t.LOOP)}))}catch(e){throw e}},o.updateSourceType=function(e){try{o.sourceType=e,e===t.LOOP?o.loop=!0:o.loop=!1,o.updateSource()}catch(e){throw e}},o.toggleLocators=function(){try{o.showLocators?(o.showLocators=!1,Object.keys(e.instances).forEach((function(t){e.instances[t].removeComponent(SphereShape)}))):(o.showLocators=!0,Object.keys(e.instances).forEach((function(t){e.instances[t].addComponentOrReplace(new SphereShape),e.instances[t].getComponent(Transform).scale.setAll(.1)})))}catch(e){throw e}},o.updatePlaylist=function(e){},o.start=function(){},o.startLive=function(){},o.startPlaylist=function(){},o.playNextClip=function(){},o.stop=function(){};try{if(o.sk=i.sk,o.customId=i.customId,o.audioPath=i.audioPath,o.volume=i.volume,o.parent=i.parent,o.sourceType=i.sourceType,o.enabled=i.enabled,e.configs[o.sk]=o,o.customId&&(e.configs[o.customId]=e.configs[o.sk]),o.customRendering||!i.instances||i.instances.length<1)return o;i.sourceType===t.STREAM?o.audioStream=new AudioStream(i.audioPath):i.sourceType!==t.CLIP&&i.sourceType!==t.LOOP||(o.audioClip=new AudioClip(i.audioPath)),i.instances.forEach((function(e){o.createInstance(e)}))}catch(e){throw log("VLM: Error creating sound config"),e}return o}return c(i,n),i}(U.AudioConfig);e.DCLConfig=n;var i=function(e){function t(t){var n=e.call(this,t)||this;return n.instances=t.instances,n}return c(t,e),t}(n);e.VLMConfig=i;var s=function(n){function i(i,s){var o=n.call(this,i,s)||this;o.add=function(){try{var t=o.parent||e.configs[o.configId].parent;t?o.updateParent(t):engine.addEntity(o)}catch(e){throw e}},o.delete=function(){try{delete e.instances[o.sk],o.customId&&delete e.instances[o.customId],o.remove()}catch(e){throw e}},o.remove=function(){try{o.isAddedToEngine()&&engine.removeEntity(o)}catch(e){throw e}},o.updateParent=function(e){try{if(e){o.parent=e;var t=W(e);o.setParent(t)}else o.setParent(null)}catch(e){throw e}},o.updateCustomId=function(t){try{o.customId&&e.instances[o.customId]&&delete e.instances[o.customId],e.instances[t]=e.instances[o.sk],o.customId=t}catch(e){throw e}},o.updateTransform=function(e,t,n){try{o.position=e||o.position,o.scale=t||o.scale,o.rotation=n||o.rotation,o.addComponentOrReplace(new Transform({position:new Vector3(o.position.x,o.position.y,o.position.z),scale:new Vector3(o.scale.x,o.scale.y,o.scale.z),rotation:Quaternion.Euler(o.rotation.x,o.rotation.y,o.rotation.z)}))}catch(e){throw e}};try{if(o.sk=s.sk,o.enabled=s.enabled&&i.enabled,o.parent=s.parent||i.parent,o.position=s.position,o.scale=s.scale,o.rotation=s.rotation,o.volume=s.volume,o.loop=i.sourceType===t.LOOP,o.configId=i.sk,i.audioClip&&i.sourceType===t.CLIP){var r=new AudioSource(i.audioClip);o.addComponent(r),r.loop=!1,r.volume=o.volume,r.playOnce()}else if(i.audioStream&&i.sourceType===t.STREAM){r=i.audioStream;o.addComponent(r),r.volume=o.volume}else if(i.sourceType===t.LOOP){r=new AudioSource(i.audioClip);o.addComponent(r),r.loop=!1,r.volume=o.volume,r.playing=o.enabled}i.sourceType<t.STREAM&&o.updateTransform(o.position,o.scale,o.rotation),o.enabled&&o.add()}catch(e){throw e}return o}return c(i,n),i}(U.Instance);e.DCLInstanceConfig=s;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(s);e.VLMInstanceConfig=o;var r=function(){function t(t){var n=this;this.timer=0,this.dtDelay=0,this.videoStatus=0,this.checkingStatus=!1,this.live=!0,this.playing=!0,this.initialCheckComplete=!1,this.instancesHidden=!1,this.stopped=!1,this.start=function(){n.config.start(),n.stopped=!1},this.stop=function(){n.config.stop(),n.stopped=!0},this.statusCheckDelay=0,this.checkStreamStatus=function(){return h(n,void 0,void 0,(function(){return f(this,(function(e){return[2]}))}))},this.setLiveState=function(e){};try{this.config=t,this.sk=t.sk,e.systems[t.sk]=this,t.customId&&(this.customId=t.customId,e.systems[this.customId]=this),engine.addSystem(e.systems[t.sk]),this.config.customRendering&&this.stop()}catch(e){throw e}}return t.prototype.update=function(){Object.keys(e.instances).forEach((function(t){var n=e.instances[t],i=.1*(Math.sin(Date.now()/1e3)+1)+.1;n.getComponent(Transform).scale.set(i,i,i)}))},t}();e.DCLSoundSystem=r}(K||(K={}));var J,q=function(){function e(){}var t;return t=e,e.init=function(e){e&&e.forEach((function(e){t.create(e)}))},e.create=function(e){try{if(log("VLM - Creating Sound"),!e.enabled)return;new K.DCLConfig(e)}catch(e){log(e),log("VLM - Error creating sound")}},e.createInstance=function(e,t){if(e.enabled&&t.enabled){var n=e.sk;K.configs[n].createInstance(t)}},e.update=function(e,n,i){var s=K.configs[e.sk];if(e&&(s||e.enabled))switch(!s&&e.enabled&&new K.DCLConfig(e),n){case"enabled":e.enabled?s&&t.add(e.sk):t.remove(e.sk);break;case"audioPath":s.updateSource(e.soundLink);break;case"properties":s.updateParent(e.parent),s.updateCustomId(e.customId)}},e.updateInstance=function(e,t,n){var i=K.instances[n],s=i.configId,o=K.configs[s];if(o){!i&&e.enabled&&o.createInstance(e);var r=e.position,a=e.scale,c=e.rotation;switch(t){case"enabled":o.enabled&&e.enabled?i&&e.enabled&&o.addInstance(e.sk):o.removeInstance(e.sk);break;case"transform":i.updateTransform(r,a,c);break;case"properties":i.updateParent(e.parent),i.updateCustomId(e.customId)}}},e.add=function(e){K.configs[e].showAll()},e.delete=function(e){K.configs[e].delete()},e.remove=function(e){K.configs[e].remove()},e.removeInstance=function(e){var t=K.instances[e].configId;K.configs[t].removeInstance(e)},e.deleteInstance=function(e){var t=K.instances[e].configId;K.configs[t].deleteInstance(e)},e}();!function(e){e.configs={};var t=function(t){this.sk=t.sk,this.id=t.id,this.type=t.type,this.value=t.value,this.user=t.user,this.init=t.init,this.delete=t.delete,this.update=t.update,e.configs[this.id]||(e.configs[this.id]=this)};e.DCLConfig=t;var n,i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(t);e.VLMConfig=i,(n=e.ControlType||(e.ControlType={}))[n.NONE=0]="NONE",n[n.TOGGLE=1]="TOGGLE",n[n.TEXT=2]="TEXT",n[n.SELECTOR=3]="SELECTOR",n[n.DATETIME=4]="DATETIME",n[n.TRIGGER=5]="TRIGGER",n[n.SLIDER=6]="SLIDER"}(J||(J={}));var X,Q=function(){function e(){}return e.configureWidgets=function(e){try{(e=Z(e)).forEach((function(e){J.configs[e.id]||(J.configs[e.id]={order:e.order,id:e.id,value:e.value,update:function(){}},e.hasOwnProperty("init")&&(J.configs[e.id].init=e.init),e.hasOwnProperty("update")&&(J.configs[e.id].update=e.update),e.hasOwnProperty("delete")&&(J.configs[e.id].delete=e.delete))})),log("VLM - Configured Widgets",e)}catch(e){throw e}},e.setState=function(e){try{if(!e)return;(e=Z(e)).forEach((function(e){var t=u({},J.configs[e.id]);J.configs[e.id]=u(u({},t),{sk:e.sk,id:e.id,order:e.order,value:e.value,type:e.type})})),log("VLM - Set Widget State",J.configs)}catch(e){throw e}},e.init=function(){var e=Object.keys(J.configs).map((function(e){return J.configs[e]}));return Z(e).forEach((function(e){if(!e||e.type===J.ControlType.TRIGGER)return J.configs;e.init?e.init(e):e.update(e)})),J.configs},e.create=function(e){try{J.configs[e.id]||(J.configs[e.id]={sk:e.sk,id:e.id,value:e.value,update:function(){}}),J.configs[e.id].value=e.value,"function"==typeof J.configs[e.id].init&&J.configs[e.id].init(e),log("VLM - Created Widget",J.configs[e.id])}catch(e){throw e}},e.update=function(e,t){try{J.configs[e.id]||(J.configs[e.id]={sk:e.sk,id:e.id,value:e.value,update:function(){}}),J.configs[e.id].value=e.value,J.configs[e.id].update(u(u({},e),{user:t})),log("VLM - Updated Widget",J.configs[e.id])}catch(e){throw e}},e.delete=function(e){try{var t=J.configs[e];if(t.value=!1,!t)return;t.delete?t.delete(t):t.update(t),delete J.configs[e],log("VLM - Deleted Widget",e)}catch(e){throw e}},e}(),Z=function(e){if(!e.some((function(e){return e.hasOwnProperty("order")})))return e;var t=e.sort((function(e,t){return e.order&&null==t.order?-1:null==e.order&&t.order?1:e.order<t.order?-1:e.order>t.order?1:0}));return e=t,log("VLM - Sorted Widgets",e),t};!function(e){var t,n;(t=e.BanActions||(e.BanActions={}))[t.WALL=0]="WALL",t[t.BLACKOUT=1]="BLACKOUT",(n=e.BanWallType||(e.BanWallType={}))[n.BLACK=0]="BLACK",n[n.INVISIBLE=1]="INVISIBLE",n[n.MIRROR=2]="MIRROR";var i=function(e){this.sk=e.sk||"",e&&(this.allowCertainWearables=e.allowCertainWearables||this.allowCertainWearables,this.banCertainWearables=e.banCertainWearables||this.banCertainWearables,this.allowCertainUsers=e.allowCertainUsers||this.allowCertainUsers,this.banCertainUsers=e.banCertainUsers||this.banCertainUsers,this.allowWeb3Only=e.allowWeb3Only||this.allowWeb3Only,this.allowedWearables=e.allowedWearables||this.allowedWearables,this.bannedWearables=e.bannedWearables||this.bannedWearables,this.bannedUsers=e.bannedUsers||this.bannedUsers,this.allowedUsers=e.allowedUsers||this.allowedUsers,this.banActions=e.banActions||this.banActions,this.banWallType=e.banWallType||this.banWallType)};e.DCLConfig=i;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(i);e.VLMConfig=s}(X||(X={}));var ee,te,ne=function(e){function t(){var t=e.call(this,ie.canvas)||this;return t.bannedUser=function(){t.visible=!0,t.text.value=ie.messages.bannedUser,t.text.visible=!0,t.exitLink.visible=!0},t.bannedWearable=function(){t.visible=!0,t.text.value=ie.messages.bannedWearable,t.text.visible=!0,t.exitLink.visible=!0},t.accessRestricted=function(){t.visible=!0,t.text.value=ie.messages.accessRestricted,t.text.visible=!0,t.exitLink.visible=!0},t.hide=function(){t.visible=!1,t.text.visible=!1,t.exitLink.visible=!1},t.width="100%",t.height="150%",t.color=Color4.Black(),t.visible=!1,t.text=new UIText(t),t.text.fontSize=24,t.text.hAlign="center",t.text.hTextAlign="center",t.text.positionY=50,t.text.color=Color4.White(),t.text.value=ie.messages.bannedUser,t.exitClickBox=new UIImage(t,new Texture("")),t.exitClickBox.width=300,t.exitClickBox.height=24,t.exitClickBox.hAlign="center",t.exitClickBox.opacity=0,t.exitClickBox.positionY=-10,t.exitClickBox.onClick=new OnPointerDown((function(){teleportTo("0,0")})),t.exitLink=new UIText(t),t.exitLink.fontSize=24,t.exitLink.hAlign="center",t.exitLink.hTextAlign="center",t.exitLink.color=Color4.White(),t.exitLink.isPointerBlocker=!1,t.exitLink.value="CLICK TO LEAVE AREA",t}return c(t,e),t}(UIContainerRect),ie=function(){function e(){}var t;return e.update=function(e){if(this.timer<2)this.timer+=e;else{if(this.timer=0,this.crashUser)return this.crash(e);var t=this,n=t.inScene,i=t.accessAllowed,s=t.bannedUser,o=t.bannedWearable;n&&(!i||s||o)&&this.banAction()}},t=e,e.parcelBounds=[],e.walls=[],e.messages={bannedUser:"You have been blocked from interacting with this scene.",bannedWearable:"One of your equipped wearables has been prohibited by this scene.",accessRestricted:"Access to this scene has been restricted."},e.crashUser=!1,e.timer=0,e.memoryHog=[],e.setCrashUser=function(e){b.sessionUser.connectedWallet!=e.walletAddress&&b.sessionUser.displayName!=e.displayName||(T.addMessage("".concat(e.displayName,", you are being asked to leave the scene."),{color:"red",fontSize:16}),t.crashUser=!0,t.crash(),t.initialized||t.init())},e.crash=function(e){if(0!==Camera.instance.position.x||0!==Camera.instance.position.y||0!==Camera.instance.position.z){o.movePlayerTo({x:0,y:0,z:0});var n=new Entity,i=new BoxShape;i.withCollisions=!0;var s=new Material;s.albedoColor=Color4.Black(),n.addComponent(i),n.addComponent(s),n.addComponent(new Transform({position:Camera.instance.position,scale:new Vector3(1,3,1)})),engine.addEntity(n),log("RUN! THE VLM IS GOING TO COLLAPSE!");for(var r="",a=0;a<1e9;a++)r+="A";t.memoryHog.push(r)}},e.init=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return engine.addSystem(this),this.initialized=!0,[2]}))}))},e.updateSettings=function(e){return h(void 0,void 0,void 0,(function(){var n,i,o=t;return f(t,(function(t){switch(t.label){case 0:return this.canvas||(this.canvas=new UICanvas,this.canvas.width="100%",this.canvas.height="100%"),this.moderationSettings=e,[4,s.getParcel()];case 1:return n=t.sent(),this.parcels=n.land.sceneJsonData.scene.parcels,i=n.land.sceneJsonData.scene.base.split(","),this.baseParcel={x:Number(i[0]),z:Number(i[1])},this.findSceneBounds(),this.runModerationChecks(),onProfileChanged.add((function(){o.runModerationChecks()})),onEnterSceneObservable.add((function(){o.inScene=!0,o.runModerationChecks()})),onLeaveSceneObservable.add((function(){o.inScene=!1})),[2]}}))}))},e.updateModeration=function(){t.runModerationChecks()},e.runModerationChecks=function(){return h(void 0,void 0,void 0,(function(){var e;return f(t,(function(t){return this.accessAllowed=!0,(e=this.moderationSettings).allowCertainWearables&&!this.hasAllowedWearables()&&(this.accessAllowed=!1),e.banCertainWearables&&this.hasBannedWearables()&&(this.accessAllowed=!1),e.allowCertainUsers&&!this.isAllowedUser()&&(this.accessAllowed=!1),e.banCertainUsers&&this.isBannedUser()&&(this.accessAllowed=!1),this.accessAllowed?(this.readmitAction(),[2]):(this.banAction(),[2])}))}))},e.wearableCheck=function(e){return b.dclUserData.avatar.wearables.some((function(t){return e.some((function(e){return t.indexOf(e.contractAddress)>=0&&t.indexOf(String(e.itemId))>0}))}))},e.hasAllowedWearables=function(){var e=t.moderationSettings.allowedWearables;if(e)return t.wearableCheck(e)},e.hasBannedWearables=function(){var e=t.moderationSettings.bannedWearables;if(e)return t.bannedWearable=t.wearableCheck(e),t.bannedWearable},e.isBannedUser=function(){var e=t.moderationSettings.bannedUsers;if(e)return t.bannedUser=e.some((function(e){var t=b.sessionUser.displayName;return b.sessionUser.displayName.indexOf("#")>=0&&(t=t.split("#")[0]),t===e.displayName||b.sessionUser.displayName===e.displayName||b.dclUserData.userId===e.walletAddress})),t.bannedUser},e.isAllowedUser=function(){var e=t.moderationSettings.allowedUsers;return e?e.some((function(e){if(e&&b.sessionUser)return e.displayName&&b.sessionUser.displayName.indexOf(e.displayName)>=0||e.walletAddress&&b.dclUserData.userId===e.walletAddress})):void 0},e.banAction=function(){t.moderationSettings.banActions&&(B(t.moderationSettings.banActions,X.BanActions.WALL)&&(t.movePlayer(),t.createWalls()),B(t.moderationSettings.banActions,X.BanActions.BLACKOUT)&&t.blackoutScreen())},e.readmitAction=function(){t.blackout&&t.blackout.hide(),t.walls.length&&t.removeWalls()},e.blackoutScreen=function(){t.blackout||(t.blackout=new ne),t.bannedUser?t.blackout.bannedUser():t.bannedWearable?t.blackout.bannedWearable():t.accessAllowed||t.blackout.accessRestricted()},e.movePlayer=function(){var e=Camera.instance.position,n=Camera.instance.feetPosition,i=Camera.instance.worldPosition;if(t.parcelBounds.length){var s=t.parcelBounds.filter((function(e){var t,n;return n=e.e>=i.x&&e.w<=i.x,t=e.n>=i.z&&e.s<=i.z,n&&t})),r=t.parcelBounds.filter((function(e){return s.some((function(t){return e.z==t.z}))})).sort((function(e,t){return t.z-e.z})),a=t.parcelBounds.filter((function(e){return s.some((function(t){return e.x==t.x}))})).sort((function(e,t){return t.x-e.x}));if(t.inScene=!!s.length,t.inScene){var c=e.z<s[0].nr+1&&e.z>s[0].nr-1,u=e.x<s[0].er+1&&e.x>s[0].er-1,d=e.z<s[0].sr+1&&e.z>s[0].sr-1,l=e.x<s[0].wr+1&&e.x>s[0].wr-1;c&&!s[0].hasAdjacentNorth?o.movePlayerTo({x:n.x,y:n.y,z:s[0].nr}):u&&!s[0].hasAdjacentEast?o.movePlayerTo({x:s[0].er,y:n.y,z:n.z}):d&&!s[0].hasAdjacentSouth?o.movePlayerTo({x:n.x,y:n.y,z:s[0].sr}):l&&!s[0].hasAdjacentWest?o.movePlayerTo({x:s[0].wr,y:n.y,z:n.z}):s[0].x>0?o.movePlayerTo({x:r[a.length-1].er,y:n.y,z:n.z}):o.movePlayerTo({x:r[0].er,y:n.y,z:n.z})}}},e.findSceneBounds=function(){return h(void 0,void 0,void 0,(function(){var e,n,i,s;return f(t,(function(t){return(e=this).sceneHeight,n=e.parcels,i=e.parcelBounds,s=e.baseParcel,Math.log(n.length+1),n.forEach((function(e){var t=e.split(","),n=Number(t[0]),o=Number(t[1]),r=o*V+V,a=n*V+V,c=o*V,u=n*V,d=(o-s.z)*V+V,l=(n-s.x)*V+V,h=(o-s.z)*V,f=(n-s.x)*V;o<0&&(c+=V,h+=V),n<0&&(u+=V,f+=V);var p={x:n,z:o,n:r,e:a,s:c,w:u,nr:d,er:l,sr:h,wr:f};i.push(p),log(i),i.forEach((function(e){var t=i.some((function(t){return(e.e===t.e||e.w===t.w)&&e.n===t.s})),n=i.some((function(t){return(e.n===t.n||e.s===t.s)&&e.e===t.w})),s=i.some((function(t){return(e.e===t.e||e.w===t.w)&&e.s===t.n})),o=i.some((function(t){return(e.n===t.n||e.s===t.s)&&e.w===t.e}));e.hasAdjacentNorth=t,e.hasAdjacentEast=n,e.hasAdjacentSouth=s,e.hasAdjacentWest=o}))})),[2]}))}))},e.createWalls=function(){var e=t,n=e.sceneHeight,i=e.walls,s=e.parcelBounds;i.length?t.updateWalls():s.forEach((function(e){var s=new PlaneShape,o=new Material,r=new Vector3(V,n,1),a=new Vector3(V,V,1),c=Quaternion.Euler(0,90,0),u=Quaternion.Euler(90,0,0);t.setWallMaterial(o);var d=e.nr,l=e.er,h=e.sr,f=e.wr,p=new Entity,v=new Vector3(l-8,n,d-8);p.addComponent(s),p.addComponent(o),p.addComponent(new Transform({position:v,scale:a,rotation:u})),engine.addEntity(p),i.push(p);var g=new Entity,m=new Vector3(l-8,n/2,d);s.withCollisions=!0,g.addComponent(s),g.addComponent(o),g.addComponent(new Transform({position:m,scale:r})),engine.addEntity(g),i.push(g);var y=new Entity,I=new Vector3(l,n/2,d-8);y.addComponent(s),y.addComponent(o),y.addComponent(new Transform({position:I,scale:r,rotation:c})),engine.addEntity(y),i.push(y);var E=new Entity,w=new Vector3(l-8,n/2,h);E.addComponent(s),E.addComponent(o),E.addComponent(new Transform({position:w,scale:r})),engine.addEntity(E),i.push(E);var T=new Entity,b=new Vector3(f,n/2,d-8);T.addComponent(s),T.addComponent(o),T.addComponent(new Transform({position:b,scale:r,rotation:c})),engine.addEntity(T),i.push(T)}))},e.removeWalls=function(){t.walls.forEach((function(e){engine.removeEntity(e)})),t.walls.length=0},e.updateWalls=function(){t.walls.forEach((function(e){var n=e.getComponent(Material);t.setWallMaterial(n)}))},e.setWallMaterial=function(e){switch(t.moderationSettings.banWallType){case X.BanWallType.BLACK:e.albedoColor=Color4.Black(),e.specularIntensity=0,e.roughness=1,e.metallic=0;break;case X.BanWallType.MIRROR:e.specularIntensity=1,e.roughness=0,e.metallic=1;break;default:e.albedoColor=new Color4(0,0,0,0)}},e}(),se=function(){function e(){}var t;return t=e,e.store={},e.initScenePreset=function(e){var n;try{var i=e.scenePreset,s=e.settingsData;H.init(i.images),z.init(i.videos),Y.init(i.nfts),q.init(i.sounds),(null===(n=null==i?void 0:i.widgets)||void 0===n?void 0:n.length)&&(Q.setState(i.widgets),Q.init(i.widgets)),(null==s?void 0:s.moderation)&&t.updateSceneSetting({settings:"moderation",settingsData:s.moderation}),$.events.fireEvent(new M)}catch(e){throw e}},e.updateScenePreset=function(e){t.scenePreset=e.scenePreset},e.createSceneElement=function(e){try{switch(e.element){case"image":H.create(e.elementData);break;case"nft":Y.create(e.elementData);break;case"video":z.create(e.elementData);break;case"sound":q.create(e.elementData);break;case"widget":Q.create(e.elementData)}}catch(e){throw e}},e.createSceneElementInstance=function(e){try{switch(e.element){case"image":H.createInstance(e.elementData,e.instanceData);break;case"nft":Y.createInstance(e.elementData,e.instanceData);break;case"video":z.createInstance(e.elementData,e.instanceData);break;case"sound":q.createInstance(e.elementData)}}catch(e){throw e}},e.updateSceneElement=function(e){try{if(e.instance)return t.updateSceneElementInstance(e);switch(e.element){case"image":H.update(e.elementData,e.property,e.id);break;case"nft":Y.update(e.elementData,e.property,e.id);break;case"video":z.update(e.elementData,e.property,e.id);break;case"sound":q.update(e.elementData,e.property,e.id);break;case"widget":Q.update(e.elementData,e.user)}}catch(e){throw e}},e.updateSceneSetting=function(e){try{if(void 0===e.settingsData)return;switch(e.setting){case"localization":break;case"moderation":ie.updateSettings(e.sceneSettings.moderation)}}catch(e){throw e}},e.updateSceneElementInstance=function(e){try{switch(e.element){case"image":H.updateInstance(e.instanceData,e.property,e.id);break;case"nft":Y.updateInstance(e.instanceData,e.property,e.id);break;case"video":z.updateInstance(e.instanceData,e.property,e.id);break;case"sound":q.updateInstance(e.elementData,e.property,e.id)}}catch(e){throw e}},e.deleteSceneElement=function(e){try{var t=e.elementData.sk||e.id;switch(e.element){case"image":H.delete(t);break;case"nft":Y.delete(t);break;case"video":z.delete(t);break;case"sound":q.delete(t);break;case"widget":Q.delete(t)}}catch(e){throw e}},e.deleteSceneElementInstance=function(e){try{var t=e.instanceData.sk||e.id;switch(e.element){case"image":H.deleteInstance(t);break;case"nft":Y.deleteInstance(t);break;case"video":z.deleteInstance(t);break;case"sound":q.deleteInstance(t)}}catch(e){throw e}},e}();!function(e){var t=function(){function e(){this._components=[],e.instance=this}return e.createAndAddToEngine=function(){return null==this.instance&&(this.instance=new e,engine.addSystem(this.instance)),this.instance},e.registerCustomComponent=function(e){this.createAndAddToEngine()._components.push(e)},e.prototype.addComponentType=function(e){var t,n;try{for(var i=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(this._components),s=i.next();!s.done;s=i.next()){if(e==s.value)return}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this._components.push(e)},e.prototype.update=function(e){var t=this;this._components.forEach((function(n){t.updateComponent(e,n)}))},e.prototype.updateComponent=function(e,t){var n=engine.getEntitiesWithComponent(t);for(var i in n)if(n.hasOwnProperty(i)){var s=n[i],o=s.getComponent(t);o.elapsedTime+=e,o.elapsedTime>=o.targetTime&&o.onTargetTimeReached(s)}},e.instance=null,e}();e.System=t;var n=function(){function t(t,i){var s=this;e.System.createAndAddToEngine().addComponentType(n),this.elapsedTime=0,this.targetTime=t/1e3,this.onTimeReachedCallback=i,this.onTargetTimeReached=function(){s.elapsedTime=0,s.onTimeReachedCallback&&s.onTimeReachedCallback()}}var n;return n=t,t.prototype.setCallback=function(e){this.onTimeReachedCallback=e},t=n=l([Component("vlmTimerInterval")],t)}();e.Interval=n;var i=function(){function t(t,i){var s=this;e.System.createAndAddToEngine().addComponentType(n),this.elapsedTime=0,this.targetTime=t/1e3,this.onTimeReachedCallback=i,this.onTargetTimeReached=function(e){s.onTimeReachedCallback&&s.onTimeReachedCallback(),e.removeComponent(s)}}var n;return n=t,t.prototype.setCallback=function(e){this.onTimeReachedCallback=e},t=n=l([Component("vlmTimerDelay")],t)}();e.Delay=i}(ee||(ee={})),function(e){var t=function(e){this.sk=e.sk||this.sk,this.userId=e.userId,this.connectedWallet=e.connectedWallet,this.sessionStart=(null==e?void 0:e.sessionStart)||Date.now(),this.sessionEnd=e.sessionEnd,this.sessionToken=e.sessionToken,this.expires=e.expires,this.sceneId=e.sceneId,this.world=e.world,this.worldLocation=e.worldLocation,this.ts=e.ts||this.ts};e.Config=t;var n=function(e){this.sk=e.sk,this.connectedWallet=e.connectedWallet,this.displayName=e.displayName||"",this.lastIp=e.lastIp,this.hasConnectedWeb3=e.hasConnectedWeb3,this.world=e.world,this.createdAt=e.createdAt};e.User=n,function(e){var t=function(e){this.sk=e.sk||this.sk,this.segments=e.segments};e.Config=t;var n,i=function(e){this.sk=e.sk||this.sk,this.pathId=e.pathId,this.type=e.type,this.path=e.path};e.Segment=i,(n=e.SegmentType||(e.SegmentType={}))[n.LOADING=0]="LOADING",n[n.IDLE=1]="IDLE",n[n.STATIONARY_DISENGAGED=2]="STATIONARY_DISENGAGED",n[n.STATIONARY_ENGAGED=3]="STATIONARY_ENGAGED",n[n.RUNNING_DISENGAGED=4]="RUNNING_DISENGAGED",n[n.WALKING_DISENGAGED=5]="WALKING_DISENGAGED",n[n.RUNNING_ENGAGED=6]="RUNNING_ENGAGED",n[n.WALKING_ENGAGED=7]="WALKING_ENGAGED"}(e.Path||(e.Path={})),e.PointLegend={0:"X-Position",1:"Y-Position",2:"Z-Position",3:"Timestamp",4:"X-Rotation",5:"Y-Rotation",6:"POV"}}(te||(te={}));var oe,re=function(){function e(){}var t;return t=e,e.logError=function(e,i){return h(void 0,void 0,void 0,(function(){var s,o,r;return f(t,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,b.getPlatformData()];case 1:return s=t.sent(),o={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({error:e,metadata:u(u(u({},s),i),{ts:Date.now()})})},[4,n.signedFetch("https://api.vlm.gg/log/error",o)];case 2:return(r=t.sent()).ok?[2,r.json]:[3,4];case 3:return t.sent(),this.reportOutage(),[3,4];case 4:return[2]}}))}))},e.reportOutage=function(){return h(void 0,void 0,void 0,(function(){var e,i;return f(t,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,b.getPlatformData()];case 1:return e=t.sent(),i={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({error:"Connection to the server could not be established.",metadata:u(u({},e),{ts:Date.now()})})},log("VLM: Connection error. Attempting to report to server."),[4,n.signedFetch("https://alerts.vlm.gg/report/outage",i)];case 2:return t.sent(),log("VLM: Message successfully sent to inform VLM of outage."),[3,4];case 3:return t.sent(),log("VLM: Could not connect to VLM's alert service either. Internet outage likely."),[3,4];case 4:return[2]}}))}))},e}(),ae=function(){function e(){e.sceneRoom=b.sceneRoom,e.sessionData=b.sessionData,$.events.fireEvent(new C({action:"path_start"}))}var t,i;return e.update=function(e){var t;if(this.counter<=this.delay)this.counter+=e;else{this.counter=0,this.dbLog("VLM PATH TRACKING - UPDATE");var n=this.lastPathPoint(),i=n[0];if(this.pathId&&(null===(t=this.pathSegments[0].path)||void 0===t?void 0:t.length)>=1e3)return this.startNewSegment(),void this.dbLog("VLM PATH TRACKING - STARTED NEW SEGMENT - 1000 POINTS REACHED");n&&Date.now()>=i+500?(this.dbLog("VLM PATH TRACKING - LOGGING PATH POINT"),this.logPathPoint()):Date.now()<i+500?this.dbLog("VLM PATH TRACKING - EXITED - NOT ENOUGH TIME PASSED SINCE LAST POINT"):(this.dbLog("VLM PATH TRACKING - EXITED - "+this.sessionData+i),this.dbLog("VLM PATH TRACKING - EXITED - FAILED TO LOG PATH POINT"))}},t=e,e.enableDebugging=!1,e.motionButtonsPressed={w:!1,a:!1,s:!1,d:!1,shift:!1},e.moving=function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!0;return!1}(((i=t.motionButtonsPressed).shift,d(i,["shift"]))),e.walking=t.motionButtonsPressed.shift&&t.moving,e.running=!t.motionButtonsPressed.shift&&t.moving,e.pathSegments=[{type:te.Path.SegmentType.LOADING,path:[]}],e.pov=2,e.started=!1,e.finished=!1,e.loading=!0,e.counter=0,e.delay=1,e.addingPaths=!1,e.pathStarted=!1,e.startPath=function(n){return h(void 0,void 0,void 0,(function(){var i;return f(t,(function(t){return i=this.sessionData.paths,n.pathId&&i&&i.indexOf(n.pathId)<0&&i.push(n.pathId),e.pathId=n.pathId,e.pathStarted=!0,e.startNewSegment(),engine.addSystem(this),[2]}))}))},e.endPath=function(e,i){return h(void 0,void 0,void 0,(function(){var s,o,r;return f(t,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,b.getPlatformData()];case 1:return s=t.sent(),o={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({error:e,sessionData:this.sessionData,pathId:this.pathId,pathSegments:this.pathSegments,metadata:u(u(u({},s),i),{ts:Date.now()})})},[4,n.signedFetch("".concat(g.apiUrl,"/session/end"),o)];case 2:return(r=t.sent()).ok?(this.dbLog("VLM PATH TRACKING - PATH ENDED"),[2,r.json]):[3,4];case 3:return t.sent(),re.reportOutage(),[3,4];case 4:return[2]}}))}))},e.initMovement=function(){return h(void 0,void 0,void 0,(function(){var e;return f(t,(function(t){return e=Input.instance,this.motionButtonsPressed.w=e.isButtonPressed(ActionButton.FORWARD).BUTTON_DOWN,this.motionButtonsPressed.s=e.isButtonPressed(ActionButton.BACKWARD).BUTTON_DOWN,this.motionButtonsPressed.a=e.isButtonPressed(ActionButton.LEFT).BUTTON_DOWN,this.motionButtonsPressed.d=e.isButtonPressed(ActionButton.RIGHT).BUTTON_DOWN,this.motionButtonsPressed.shift=e.isButtonPressed(ActionButton.WALK).BUTTON_DOWN,this.moving=this.motionButtonsPressed.w||this.motionButtonsPressed.a||this.motionButtonsPressed.s||this.motionButtonsPressed.d,this.walking=this.moving&&this.motionButtonsPressed.shift,this.loading=!1,[2]}))}))},e.startNewSegment=function(e){var n,i,s;if(t.pathStarted)try{var o=t.pathSegments.some((function(e){var t;return(null==e?void 0:e.path)&&(null===(t=e.path)||void 0===t?void 0:t.length)>=1e3})),r=t.pathSegments[0].type==te.Path.SegmentType.LOADING,a=t.pathSegments[0],c=t.pathSegments[1],u=r?(null===(n=t.sessionData)||void 0===n?void 0:n.sessionStart)||Date.now():t.pathSegments[0].path[0][0],d=Date.now()-(u||0);if(r&&(t.initMovement(),t.sessionData.sessionStart==(null===(i=t.sessionData)||void 0===i?void 0:i.sessionStart)||Date.now(),t.pathSegments[0].path.push(t.getPathPoint(!0)),t.dbLog("VLM PATH TRACKING - ADDED FIRST PATH SEGMENT")),d<2500&&e&&e>=te.Path.SegmentType.RUNNING_DISENGAGED&&c.type&&c.type<te.Path.SegmentType.RUNNING_DISENGAGED)return a.type=e,void t.dbLog("VLM PATH TRACKING - CHANGED SEGMENT TYPE - STARTED MOVING");if(c&&a.type===c.type)return c.path=v(v([],p(c.path),!1),p(a.path),!1),t.pathSegments.shift(),void t.dbLog("VLM PATH TRACKING - MERGED IDENTICAL SEGMENTS");if(d<5e3)return;var l=void 0;if(l=e||(t.walking&&t.engaged?te.Path.SegmentType.WALKING_ENGAGED:t.running&&t.engaged?te.Path.SegmentType.RUNNING_ENGAGED:t.walking?te.Path.SegmentType.WALKING_DISENGAGED:t.running?te.Path.SegmentType.RUNNING_DISENGAGED:t.idle?te.Path.SegmentType.IDLE:t.engaged?te.Path.SegmentType.STATIONARY_ENGAGED:t.loading?te.Path.SegmentType.LOADING:te.Path.SegmentType.STATIONARY_DISENGAGED),t.pathSegments[0].type==l)return void t.dbLog("VLM PATH TRACKING - NO CHANGE IN SEGMENT TYPE");var h=t.getPathPoint();a.path.push(h);var f=new te.Path.Segment({type:l,path:[h]});t.pathSegments.unshift(f),(!t.addingPaths&&(null===(s=t.pathSegments)||void 0===s?void 0:s.length)>=25||o)&&(t.dbLog("VLM PATH TRACKING - SUBMITTING A BATCH OF PATH SEGMENTS"),t.addingPaths=!0,$.events.fireEvent(new C({action:"path_segments_add",pathId:t.pathId,pathSegments:t.pathSegments})))}catch(e){throw t.dbLog("VLM PATH TRACKING - ERROR STARTING NEW SEGMENT"),e}else t.dbLog("VLM PATH TRACKING - EXITED - PATH HASN'T STARTED")},e.trimStoredSegments=function(e){var n;t.dbLog("VLM PATH TRACKING - TRIMMING PATH SEGMENTS"),(null===(n=t.pathSegments)||void 0===n?void 0:n.length)&&(t.pathSegments.splice(t.pathSegments.length-e.added),t.dbLog("VLM PATH TRACKING - "+e.added+" PATH SEGMENTS TRIMMED ")),t.addingPaths=!1},e.getPathPoint=function(e){var n,i,s,o,r,a,c;t.approximatePathPoint();var u=[e?0:Date.now()-((null===(n=t.sessionData)||void 0===n?void 0:n.sessionStart)||0),null===(i=t.playerPosition)||void 0===i?void 0:i.x,null===(s=t.playerPosition)||void 0===s?void 0:s.y,null===(o=t.playerPosition)||void 0===o?void 0:o.z,null===(r=t.cameraRotation)||void 0===r?void 0:r.x,null===(a=t.cameraRotation)||void 0===a?void 0:a.y,null===(c=t.cameraRotation)||void 0===c?void 0:c.z,t.pov];return t.dbLog("VLM PATH TRACKING - NEW PATH POINT \n"+JSON.stringify(u)),u},e.logPathPoint=function(e){var n=t.lastPathPoint(),i=t.getPathPoint();t.updateMovingState();var s=n&&t.comparePoints(i,n);try{if(!e&&s)return void t.dbLog("VLM PATH TRACKING - POINT ALREADY TRACKED");t.pathSegments[0].path.push(i)}catch(e){t.dbLog("VLM PATH TRACKING - ERROR LOGGING PATH POINT")}},e.comparePoints=function(e,t){if((null==e?void 0:e.length)&&(null==t?void 0:t.length)){var n=e[1]==t[1],i=e[2]==t[2],s=e[3]==t[3];return n&&i&&s}},e.lastPathPoint=function(){var e;return t.pathSegments[0].path&&(null===(e=t.pathSegments[0].path)||void 0===e?void 0:e.length)?t.pathSegments[0].path[t.pathSegments[0].path.length-1]:t.getPathPoint()},e.approximatePathPoint=function(){var e=u({},Camera.instance.feetPosition),n=u({},Camera.instance.rotation.eulerAngles),i=u({},Camera.instance.position);[e,i,n].forEach((function(e){Object.keys(e).forEach((function(){e.x=Number(e.x.toFixed(2)),e.y=Number(e.x.toFixed(2)),e.z=Number(e.x.toFixed(2))}))})),t.playerPosition=e,t.cameraPosition=i,t.cameraRotation=n},e.updateMovingState=function(e,n){return h(void 0,void 0,void 0,(function(){var i,s,o,r;return f(t,(function(t){return e&&(this.motionButtonsPressed[e]=!!n),i=this.motionButtonsPressed.w||this.motionButtonsPressed.a||this.motionButtonsPressed.s||this.motionButtonsPressed.d,s=this.motionButtonsPressed.shift&&i,o=i&&!this.motionButtonsPressed.shift,r=this.engaged,o&&r?this.startRunningEngaged():s&&r?this.startWalkingEngaged():o?this.startRunningDisengaged():s?this.startWalkingDisengaged():!i&&r?this.startStationaryEngaged():this.idle?this.startIdleSegment():this.startStationaryDisengaged(),[2]}))}))},e.startRunningEngaged=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return this.moving=!0,this.walking=!1,this.running=!0,this.startNewSegment(te.Path.SegmentType.RUNNING_ENGAGED),[2]}))}))},e.startWalkingEngaged=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return this.moving=!0,this.walking=!0,this.running=!1,this.startNewSegment(te.Path.SegmentType.WALKING_ENGAGED),[2]}))}))},e.startRunningDisengaged=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return this.moving=!0,this.walking=!1,this.running=!0,this.startNewSegment(te.Path.SegmentType.RUNNING_DISENGAGED),[2]}))}))},e.startWalkingDisengaged=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return this.moving=!0,this.walking=!0,this.running=!1,this.startNewSegment(te.Path.SegmentType.WALKING_DISENGAGED),[2]}))}))},e.startStationaryEngaged=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return this.moving=!1,this.walking=!1,this.running=!1,this.engaged=!0,this.startNewSegment(te.Path.SegmentType.STATIONARY_ENGAGED),[2]}))}))},e.startStationaryDisengaged=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return this.moving=!1,this.walking=!1,this.running=!1,this.engaged=!1,this.startNewSegment(te.Path.SegmentType.STATIONARY_DISENGAGED),[2]}))}))},e.startIdleSegment=function(){return h(void 0,void 0,void 0,(function(){return f(t,(function(e){return this.moving=!1,this.walking=!1,this.running=!1,this.engaged=!1,this.idle=!0,this.startNewSegment(te.Path.SegmentType.IDLE),[2]}))}))},e.dbLog=function(e){t.enableDebugging&&log(e)},e}(),ce=function(){function e(){}var t;return t=e,e.inboundMessageFunctions={},e.init=function(){try{t.sceneRoom=b.sceneRoom,t.sessionData=b.sessionData,t.sessionUser=b.sessionUser,onIdleStateChangedObservable.add((function(e){if(e.isIdle)ae.idle=!0,$.events.fireEvent(new _("Went Idle")),ae.startIdleSegment();else{var t=new Entity,n=new ee.Delay(1e3,(function(){ae.idle&&(ae.idle=!1,$.events.fireEvent(new _("Became Active")),ae.startNewSegment()),engine.removeEntity(t)}));t.addComponent(n),engine.addEntity(t)}})),onPointerLockedStateChange.add((function(e){e.locked?(ae.engaged=!0,ae.startStationaryEngaged(),$.events.fireEvent(new _("Engaged Cursor"))):(ae.engaged=!1,ae.startStationaryDisengaged(),$.events.fireEvent(new _("Disengaged Cursor")))}));var e=Input.instance;e.subscribe("BUTTON_DOWN",ActionButton.FORWARD,!1,(function(e){ae.updateMovingState("w",!0)})),e.subscribe("BUTTON_DOWN",ActionButton.BACKWARD,!1,(function(e){ae.updateMovingState("s",!0)})),e.subscribe("BUTTON_DOWN",ActionButton.LEFT,!1,(function(e){ae.updateMovingState("a",!0)})),e.subscribe("BUTTON_DOWN",ActionButton.RIGHT,!1,(function(e){ae.updateMovingState("d",!0)})),e.subscribe("BUTTON_DOWN",ActionButton.WALK,!1,(function(e){ae.updateMovingState("shift",!0)})),e.subscribe("BUTTON_DOWN",ActionButton.JUMP,!1,(function(e){$.events.fireEvent(new _("Player Jumped"))})),e.subscribe("BUTTON_UP",ActionButton.FORWARD,!1,(function(e){ae.updateMovingState("w",!1)})),e.subscribe("BUTTON_UP",ActionButton.BACKWARD,!1,(function(e){ae.updateMovingState("s",!1)})),e.subscribe("BUTTON_UP",ActionButton.LEFT,!1,(function(e){ae.updateMovingState("a",!1)})),e.subscribe("BUTTON_UP",ActionButton.RIGHT,!1,(function(e){ae.updateMovingState("d",!1)})),e.subscribe("BUTTON_UP",ActionButton.WALK,!1,(function(e){ae.updateMovingState("shift",!1)})),onPlayerExpressionObservable.add((function(e){var t=e.expressionId;log("VLM | SESSION ACTION: Emote triggered - ".concat(t)),$.events.fireEvent(new _("Emote Used",{emote:t}))})),onPlayerClickedObservable.add((function(e){$.events.fireEvent(new _("Viewed A User Profile",e)),log("VLM | SESSION ACTION: Viewed A User Profile",e.userId)})),onPlayerConnectedObservable.add((function(e){var n=e.userId;return h(void 0,void 0,void 0,(function(){var e,i;return f(t,(function(t){switch(t.label){case 0:return ae.engaged||ae.moving?[4,r.getPlayerData({userId:n})]:[3,3];case 1:return e=t.sent(),[4,r.getPlayersInScene()];case 2:i=t.sent(),log("VLM | SESSION ACTION: Witnessed Connection",n),$.events.fireEvent(new L("Witnessed ".concat((null==e?void 0:e.displayName)||"Someone"," Connect"),{userId:n,otherPlayers:i})),t.label=3;case 3:return[2]}}))}))})),onPlayerDisconnectedObservable.add((function(e){var n=e.userId;return h(void 0,void 0,void 0,(function(){var e,i;return f(t,(function(t){switch(t.label){case 0:return ae.engaged||ae.moving?[4,r.getPlayersInScene()]:[3,3];case 1:return e=t.sent(),[4,r.getPlayerData({userId:n})];case 2:i=t.sent(),log("VLM | SESSION ACTION: Witnessed Disconnection",n),$.events.fireEvent(new L("Witnessed ".concat((null==i?void 0:i.displayName)||"Someone"," Disconnect"),{userId:n,otherPlayers:e})),t.label=3;case 3:return[2]}}))}))})),onEnterSceneObservable.add((function(e){var n=e.userId;return h(void 0,void 0,void 0,(function(){var e,i,s,o;return f(t,(function(t){switch(t.label){case 0:return(null===(s=this.sessionUser)||void 0===s?void 0:s.connectedWallet)?[4,r.getPlayersInScene()]:[2];case 1:return e=t.sent(),n!=(null===(o=this.sessionUser)||void 0===o?void 0:o.connectedWallet)?[3,2]:(log("VLM | SESSION ACTION: Player Entered Scene Boundaries",n),$.events.fireEvent(new _("Player Entered Scene Boundaries",{userId:n,otherPlayers:e})),[3,4]);case 2:return ae.moving||ae.engaged?(log("VLM | SESSION ACTION: Witnessed Player Enter Scene Boundaries",n),[4,r.getPlayerData({userId:n})]):[3,4];case 3:i=t.sent(),$.events.fireEvent(new _("Witnessed ".concat((null==i?void 0:i.displayName)||"Someone"," Enter Scene"),{userId:n,otherPlayers:e,witness:this.sessionUser.connectedWallet})),t.label=4;case 4:return[2]}}))}))})),onLeaveSceneObservable.add((function(e){var n=e.userId;return h(void 0,void 0,void 0,(function(){var e,i,s,o;return f(t,(function(t){switch(t.label){case 0:return(null===(s=this.sessionUser)||void 0===s?void 0:s.connectedWallet)?[4,r.getPlayersInScene()]:[2];case 1:return e=t.sent(),n!=(null===(o=this.sessionUser)||void 0===o?void 0:o.connectedWallet)?[3,2]:($.events.fireEvent(new _("Left Scene Boundaries",{userId:n,otherPlayers:e})),[3,4]);case 2:return ae.moving||ae.engaged?[4,r.getPlayerData({userId:n})]:[3,4];case 3:i=t.sent(),$.events.fireEvent(new _("Witnessed ".concat((null==i?void 0:i.displayName)||"Someone"," Leave Scene"),{userId:n,otherPlayers:e,witness:this.sessionUser.connectedWallet})),t.label=4;case 4:return[2]}}))}))})),$.events.addListener(_,null,(function(e){var n,i=e.action,s=e.metadata;if(null===(n=t.sessionData)||void 0===n?void 0:n.sessionToken){var o=ae.getPathPoint();t.sceneRoom.send("session_action",{action:i,metadata:s,pathPoint:o,sessionToken:t.sessionData.sessionToken}),log("VLM - LOGGED ANALYTICS ACTION - ",i,o,s)}})),$.events.addListener(N,null,(function(e){var n=e.elementData,i=e.userId,s=n.sk;log(i,t.sessionUser,s,K.configs[s]),i==t.sessionUser.sk&&K.configs[s].toggleLocators()})),$.events.addListener(C,null,(function(e){switch(log("VLM: Triggered client path event",e),e.action){case"path_start":t.sceneRoom.send("path_start",{session:t.sessionData});break;case"path_segments_add":t.sceneRoom.send("path_segments_add",e)}})),$.events.addListener(O,null,(function(e){switch(e.action){case"path_started":var n=t.sessionData.paths;e.pathId&&n&&n.indexOf(e.pathId)<0&&n.push(e.pathId),ae.startPath(e);break;case"path_segments_added":ae.trimStoredSegments(e)}})),$.events.addListener(R,null,(function(e){switch(e.action){case"init":se.initScenePreset(e);break;case"create":!0===e.instance?se.createSceneElementInstance(e):se.createSceneElement(e);break;case"update":!0===e.instance?se.updateSceneElementInstance(e):se.updateSceneElement(e);break;case"delete":!0===e.instance?se.deleteSceneElementInstance(e):se.deleteSceneElement(e)}})),$.events.addListener(x,null,(function(e){var n=e.sk;if(n){var i=F.configs[n];(null==i?void 0:i.liveSrc)==e.url?(log("VLM - VIDEO STATE CHANGED",e),i.setLiveState(e.status)):i&&t.sceneRoom.send("scene_video_update",u(u({},e),{reason:"url_changed"}))}})),$.events.addListener(S,null,(function(e){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){switch(t.label){case 0:return[4,Q.configureWidgets(e.configs)];case 1:return t.sent(),[2]}}))}))})),t.sceneRoom.onLeave((function(){ae.endPath()})),t.sceneRoom.onMessage("session_started",(function(e){var n;t.sessionData=e.session,(null===(n=t.sessionData)||void 0===n?void 0:n.sessionStart)||(t.sessionData.sessionStart=Date.now()),new ae})),t.sceneRoom.onMessage("user_message",(function(e){$.events.fireEvent(new A(e))})),$.events.addListener(A,null,(function(e){return h(void 0,void 0,void 0,(function(){var n,i;return f(t,(function(t){return"inbound"==(null==e?void 0:e.type)?(log("VLM - MESSAGE RECEIVED FROM USER",e),null===(i=(n=this.inboundMessageFunctions)[e.id])||void 0===i||i.call(n,e.data)):"outbound"==(null==e?void 0:e.type)?this.sceneRoom.send("user_message",e):"getState"==(null==e?void 0:e.type)?this.sceneRoom.send("get_user_state",e):"setState"==(null==e?void 0:e.type)&&this.sceneRoom.send("set_user_state",e),[2]}))}))})),t.sceneRoom.onMessage("path_segments_added",(function(e){$.events.fireEvent(new O(e))})),t.sceneRoom.onMessage("path_started",(function(e){$.events.fireEvent(new O(e))})),t.sceneRoom.onMessage("scene_sound_locator",(function(e){$.events.fireEvent(new N(e))})),t.sceneRoom.onMessage("show_sound_locators",(function(e){$.events.fireEvent(new N(e))})),t.sceneRoom.onMessage("scene_preset_update",(function(e){e.action&&$.events.fireEvent(new R(e))})),t.sceneRoom.onMessage("scene_moderator_message",(function(e){T.addMessage(e.message,u({},e))})),t.sceneRoom.onMessage("scene_moderator_crash",(function(e){ie.setCrashUser(e)})),t.sceneRoom.onMessage("scene_video_status",(function(e){log("Video State Changed!",e),$.events.fireEvent(new x(e))})),t.sceneRoom.send("session_start",t.sessionData)}catch(e){throw log("VLM - ERROR - ERROR REGISTERING EVENT LISTENERS",e),e}},e.sendMessage=function(e,t){$.events.fireEvent(new A({id:e,data:t,type:"outbound"}))},e.onMessage=function(e,t){$.events.fireEvent(new A({id:e,data:t,type:"inbound"}))},e.setState=function(e,t){$.events.fireEvent(new A({id:e,data:t,type:"setState"}))},e.getState=function(e,t){$.events.fireEvent(new A({id:e,data:t,type:"getState"}))},e.recordAction=function(e,t){$.events.fireEvent(new _(e,t))},e}(),ue=function(){function e(){}var t;return t=e,e.version="0.0.2",e.uiCanvas=new UICanvas,e.init=function(n){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){return[2,new Promise((function(t,i){return h(void 0,void 0,void 0,(function(){var s;return f(this,(function(o){switch(o.label){case 0:return o.trys.push([0,7,,8]),(null==n?void 0:n.widgets)?[4,Q.configureWidgets(n.widgets)]:[3,2];case 1:o.sent(),o.label=2;case 2:return[4,g.init((null==n?void 0:n.env)||"prod")];case 3:return o.sent(),[4,T.init()];case 4:return o.sent(),[4,b.start(e.version)];case 5:return o.sent(),[4,ce.init()];case 6:return o.sent(),$.events.addListener(M,null,(function(){t(e.storage)})),[3,8];case 7:return s=o.sent(),re.logError(s,u(u({},n),{message:"VLM INIT ERROR",version:e.version,env:(null==n?void 0:n.env)||"prod"})),i(s),[3,8];case 8:return[2]}}))}))}))]}))}))},e.configureWidgets=function(e){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){return[2,Q.configureWidgets(e)]}))}))},e.sendMessage=function(e,n){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){return ce.sendMessage(e,n),[2]}))}))},e.onMessage=function(e,n){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){return ce.onMessage(e,n),[2]}))}))},e.setState=function(e,n){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){return ce.setState(e,n),[2]}))}))},e.getState=function(e){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){return ce.getState(e),[2]}))}))},e.recordAction=function(e,n){return h(void 0,void 0,void 0,(function(){return f(t,(function(t){return ce.recordAction(e,n),[2]}))}))},e.Storage={videos:{configs:F.configs,instances:F.instances,systems:F.systems},images:{configs:G.configs,instances:G.instances},nfts:{configs:j.configs,instances:j.instances},sounds:{configs:K.configs,instances:K.instances,systems:K.systems},widgets:{configs:J.configs}},e.storage=t.Storage,e}(),de="Sorry, you must connect a wallet to claim this item.",le="Success! Your item will appear in your backpack soon.",he="This item cannot be claimed yet.",fe="This item can no longer be claimed.",pe="We have received your claim and your item will appear in your backpack soon.",ve="This item can no longer be claimed.",ge="All of the giveaway items have been claimed.",me="VPN detected. Please disconnect to claim this item.",ye="Sorry, something went wrong.";!function(e){var t,i;(t=e.ClaimRejection||(e.ClaimRejection={}))[t.BEFORE_EVENT_START=0]="BEFORE_EVENT_START",t[t.AFTER_EVENT_END=1]="AFTER_EVENT_END",t[t.EXISTING_WALLET_CLAIM=2]="EXISTING_WALLET_CLAIM",t[t.OVER_IP_LIMIT=3]="OVER_IP_LIMIT",t[t.SUPPLY_DEPLETED=4]="SUPPLY_DEPLETED",t[t.INAUTHENTIC=5]="INAUTHENTIC",t[t.SUSPICIOUS=6]="SUSPICIOUS",(i=e.ClaimResponseType||(e.ClaimResponseType={}))[i.CLAIM_ACCEPTED=0]="CLAIM_ACCEPTED",i[i.CLAIM_DENIED=1]="CLAIM_DENIED",i[i.CLAIM_IN_PROGRESS=2]="CLAIM_IN_PROGRESS";var s=function(e,t){var n,i,s,o=this;this.claim=function(e,t){return h(o,void 0,void 0,(function(){return f(this,(function(n){return b.sessionUser.hasConnectedWeb3?(this.requestInProgress||(T.running&&T.init(),b.events.fireEvent(new D({action:"claim",claimAction:e,messageOptions:t}))),[2]):(T.addMessage(de),[2])}))}))};var r=this;this.actionId=e.actionId,this.position=e.position,this.scale=e.scale,this.glb=e.glb,this.image=e.image,this.clickDistance=e.clickDistance,this.rotation=e.rotation,this.hoverText=e.hoverText,this.messageColor=t.color,this.messageFontSize=t.fontSize,this.requestInProgress=!1;var a=new Entity("Giveaway Trigger");if(engine.addEntity(a),this.glb)a.addComponent(new GLTFShape(this.glb||"../vlm-giveaway/VLM-Sign.glb"));else if(this.image){var c=new PlaneShape;c.uvs=[0,0,1,0,1,1,0,1,1,0,0,0,0,1,1,1],a.addComponent(c);var u=new Material,d=new Texture(this.image);u.albedoTexture=d,u.emissiveTexture=d,u.emissiveIntensity=1,u.emissiveColor=Color3.White(),u.transparencyMode=TransparencyMode.ALPHA_TEST,a.addComponentOrReplace(u)}else a.addComponent(new BoxShape);var l=new Transform({position:new Vector3(this.position.x||8,this.position.y||8,this.position.z||8),rotation:Quaternion.Euler(0,this.rotation||0,0),scale:new Vector3((null===(n=this.scale)||void 0===n?void 0:n.x)||1,(null===(i=this.scale)||void 0===i?void 0:i.y)||1,(null===(s=this.scale)||void 0===s?void 0:s.z)||1)});a.addComponentOrReplace(l),a.addComponent(new OnPointerDown((function(){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,r.claim(r.actionId)];case 1:return e.sent(),[2]}}))}))}),{button:ActionButton.POINTER,hoverText:r.hoverText||"Claim Item",distance:r.clickDistance||5}))};e.ClaimPoint=s;var o=function(e,t){var i=this;this.claim=function(){return h(i,void 0,void 0,(function(){var e,t,i;return f(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),b.sessionUser.hasConnectedWeb3?this.requestInProgress?[2]:(this.requestInProgress=!0,[4,n.signedFetch("".concat(g.apiUrl,"/nft"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({claimAction:this.claimAction})})]):(T.addMessage(de),[2]);case 1:return(i=s.sent()).text?(e=JSON.parse(i.text),this.showMessage(e,this.messageOptions),[2,e]):[2];case 2:return t=s.sent(),i={error:!0,message:t},this.showMessage(i,this.messageOptions),[2,i];case 3:return[2]}}))}))},this.showMessage=function(e,t){e.error?T.addMessage(ye,t):e.reason===r.BEFORE_EVENT?T.addMessage(he,t):e.reason===r.AFTER_EVENT?T.addMessage(fe,t):e.reason===r.EXISTING_CLAIM?T.addMessage(pe,t):e.reason===r.IP_LIMIT?T.addMessage(ve,t):e.reason===r.NO_SUPPLY?T.addMessage(ge,t):e.reason===r.INAUTHENTIC?T.addMessage(me,t):e.success&&T.addMessage(le,t)},this.claimAction=e,this.messageOptions=t,this.requestInProgress=!1};e.DCLConfig=o;var r,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(o);e.VLMConfig=a,function(e){e[e.BEFORE_EVENT=0]="BEFORE_EVENT",e[e.AFTER_EVENT=1]="AFTER_EVENT",e[e.EXISTING_CLAIM=2]="EXISTING_CLAIM",e[e.IP_LIMIT=3]="IP_LIMIT",e[e.NO_SUPPLY=4]="NO_SUPPLY",e[e.MANIPULATION=5]="MANIPULATION",e[e.INAUTHENTIC=6]="INAUTHENTIC"}(r||(r={}))}(oe||(oe={}));var Ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(F.VLMConfig),Ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(F.VLMInstanceConfig),we=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(G.VLMConfig),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(G.VLMInstanceConfig),be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(j.VLMConfig),Ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(j.VLMInstanceConfig),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(K.VLMConfig),Ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(K.VLMInstanceConfig),Oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(J.VLMConfig);e.ImageConfig=we,e.ImageInstanceConfig=Te,e.NFTConfig=be,e.NFTInstanceConfig=Ae,e.SoundConfig=Se,e.SoundInstanceConfig=Ce,e.VideoConfig=Ie,e.VideoInstanceConfig=Ee,e.WidgetConfig=Oe,e.default=ue,Object.defineProperty(e,"__esModule",{value:!0})}));
